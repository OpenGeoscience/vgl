function inherit(a,b){"use strict";var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.uber=b.prototype,a.prototype.constructor=a}if("undefined"==typeof ogs)var ogs={};ogs.namespace=function(a){"use strict";var b,c=a.split("."),d=ogs;for("ogs"===c[0]&&(c=c.slice(1)),b=0;b<c.length;b+=1)"undefined"==typeof d[c[b]]&&(d[c[b]]={}),d=d[c[b]];return d};var vgl=ogs.namespace("gl");Object.size=function(a){"use strict";var b=0,c=null;for(c in a)a.hasOwnProperty(c)&&(b+=1);return b},vgl.GL={ACTIVE_ATTRIBUTES:35721,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB565:36194,RGB5_A1:32855,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0};var m_globalModifiedTime=0;vgl.timestamp=function(){"use strict";if(!(this instanceof vgl.timestamp))return new vgl.timestamp;var a=0;this.modified=function(){m_globalModifiedTime+=1,a=m_globalModifiedTime},this.getMTime=function(){return a}},vgl.object=function(){"use strict";if(!(this instanceof vgl.object))return new vgl.object;var a=vgl.timestamp();return a.modified(),this.modified=function(){a.modified()},this.getMTime=function(){return a.getMTime()},this},vgl.event=function(){"use strict";return this instanceof vgl.event?(vgl.object.call(this),this):new vgl.event},inherit(vgl.event,vgl.object),vgl.event.keyPress="vgl.event.keyPress",vgl.event.mousePress="vgl.event.mousePress",vgl.event.mouseRelease="vgl.event.mouseRelease",vgl.event.contextMenu="vgl.event.contextMenu",vgl.event.configure="vgl.event.configure",vgl.event.enable="vgl.event.enable",vgl.event.mouseWheel="vgl.event.mouseWheel",vgl.event.keyRelease="vgl.event.keyRelease",vgl.event.middleButtonPress="vgl.event.middleButtonPress",vgl.event.startInteraction="vgl.event.startInteraction",vgl.event.enter="vgl.event.enter",vgl.event.rightButtonPress="vgl.event.rightButtonPress",vgl.event.middleButtonRelease="vgl.event.middleButtonRelease",vgl.event["char"]="vgl.event.char",vgl.event.disable="vgl.event.disable",vgl.event.endInteraction="vgl.event.endInteraction",vgl.event.mouseMove="vgl.event.mouseMove",vgl.event.mouseOut="vgl.event.mouseOut",vgl.event.expose="vgl.event.expose",vgl.event.timer="vgl.event.timer",vgl.event.leftButtonPress="vgl.event.leftButtonPress",vgl.event.leave="vgl.event.leave",vgl.event.rightButtonRelease="vgl.event.rightButtonRelease",vgl.event.leftButtonRelease="vgl.event.leftButtonRelease",vgl.event.click="vgl.event.click",vgl.event.dblClick="vgl.event.dblClick",vgl.boundingObject=function(){"use strict";if(!(this instanceof vgl.boundingObject))return new vgl.boundingObject;vgl.object.call(this);var a=[0,0,0,0,0,0],b=vgl.timestamp(),c=vgl.timestamp();return b.modified(),c.modified(),this.bounds=function(){return a},this.hasValidBounds=function(a){return a[0]===Number.MAX_VALUE||a[1]===-Number.MAX_VALUE||a[2]===Number.MAX_VALUE||a[3]===-Number.MAX_VALUE||a[4]===Number.MAX_VALUE||a[5]===-Number.MAX_VALUE?!1:!0},this.setBounds=function(c,d,e,f,g,h){return this.hasValidBounds([c,d,e,f,g,h])?(a[0]=c,a[1]=d,a[2]=e,a[3]=f,a[4]=g,a[5]=h,this.modified(),b.modified(),!0):void 0},this.resetBounds=function(){a[0]=Number.MAX_VALUE,a[1]=-Number.MAX_VALUE,a[2]=Number.MAX_VALUE,a[3]=-Number.MAX_VALUE,a[4]=Number.MAX_VALUE,a[5]=-Number.MAX_VALUE,this.modified()},this.computeBounds=function(){},this.computeBoundsTimestamp=function(){return b},this.boundsDirtyTimestamp=function(){return c},this.resetBounds(),this},vgl.boundingObject.ReferenceFrame={Relative:0,Absolute:1},inherit(vgl.boundingObject,vgl.object),vgl.node=function(){"use strict";if(!(this instanceof vgl.node))return new vgl.node;vgl.boundingObject.call(this);var a=null,b=null,c=!0,d=!1;return this.accept=function(a){a.visit(this)},this.material=function(){return b},this.setMaterial=function(a){return a!==b?(b=a,this.modified(),!0):!1},this.visible=function(){return c},this.setVisible=function(a){return a!==c?(c=a,this.modified(),!0):!1},this.parent=function(){return a},this.setParent=function(b){return b!==a?(null!==a&&a.removeChild(this),a=b,this.modified(),!0):!1},this.overlay=function(){return d},this.setOverlay=function(a){return d!==a?(d=a,this.modified(),!0):!1},this.ascend=function(a){a=a},this.traverse=function(a){a=a},this.boundsModified=function(){this.boundsDirtyTimestamp().modified(),null!==a&&a.boundsModified()},this},inherit(vgl.node,vgl.boundingObject),vgl.groupNode=function(){"use strict";if(!(this instanceof vgl.groupNode))return new vgl.groupNode;vgl.node.call(this);var a=[];return this.b_setVisible=this.setVisible,this.setVisible=function(b){var c;if(this.b_setVisible(b)!==!0)return!1;for(c=0;c<a.length;c+=1)a[c].setVisible(b);return!0},this.addChild=function(b){return b instanceof vgl.node&&-1===a.indexOf(b)?(b.setParent(this),a.push(b),this.boundsDirtyTimestamp().modified(),!0):!1},this.removeChild=function(b){if(b.parent()===this){var c=a.indexOf(b);return a.splice(c,1),this.boundsDirtyTimestamp().modified(),!0}},this.removeChildren=function(){var b;for(b=0;b<a.length;b+=1)this.removeChild(a[b]);this.modified()},this.children=function(){return a},this.hasChild=function(b){var c=0,d=!1;for(c=0;c<a.length;c+=1)if(a[c]===b){d=!0;break}return d},this.accept=function(a){a.visit(this)},this.traverse=function(a){switch(a.type()){case a.UpdateVisitor:this.traverseChildrenAndUpdateBounds(a);break;case a.CullVisitor:this.traverseChildren(a)}},this.traverseChildrenAndUpdateBounds=function(b){var c;if(this.m_parent&&this.boundsDirtyTimestamp().getMTime()>this.computeBoundsTimestamp().getMTime()&&this.m_parent.boundsDirtyTimestamp.modified(),this.computeBounds(),b.mode()===b.TraverseAllChildren)for(c=0;c<a.length();c+=1)a[c].accept(b),this.updateBounds(a[c]);this.computeBoundsTimestamp().modified()},this.traverseChildren=function(b){var c;if(b.mode()===vgl.vesVisitor.TraverseAllChildren)for(c=0;c<a.length();c+=1)a[c].accept(b)},this.computeBounds=function(){var b=0;if(!(this.computeBoundsTimestamp().getMTime()>this.boundsDirtyTimestamp().getMTime()))for(b=0;b<a.length;b+=1)this.updateBounds(a[b])},this.updateBounds=function(a){if(!a.overlay()){a.computeBounds();var b,c=this.bounds(),d=a.bounds(),e=0,f=0;for(b=0;3>b;b+=1)e=2*b,f=2*b+1,d[e]<c[e]&&(c[e]=d[e]),d[f]>c[f]&&(c[f]=d[f]);this.setBounds(c[0],c[1],c[2],c[3],c[4],c[5])}},this},inherit(vgl.groupNode,vgl.node),vgl.actor=function(){"use strict";if(!(this instanceof vgl.actor))return new vgl.actor;vgl.node.call(this);var a=this,b=mat4.create(),c=vgl.boundingObject.ReferenceFrame.Relative,d=null;return this.matrix=function(){return b},this.setMatrix=function(c){c!==b&&(b=c,a.modified())},this.referenceFrame=function(){return c},this.setReferenceFrame=function(b){return b!==c?(c=b,a.modified(),!0):!1},this.mapper=function(){return d},this.setMapper=function(b){b!==d&&(d=b,a.boundsModified())},this.accept=function(a){a=a},this.ascend=function(a){a=a},this.computeLocalToWorldMatrix=function(a,b){a=a,b=b},this.computeWorldToLocalMatrix=function(a,b){a=a,b=b},this.computeBounds=function(){if(null===d||void 0===d)return void a.resetBounds();var c,e,f,g,h=a.computeBoundsTimestamp();(a.boundsDirtyTimestamp().getMTime()>h.getMTime()||d.boundsDirtyTimestamp().getMTime()>h.getMTime())&&(d.computeBounds(),c=d.bounds(),e=[c[0],c[2],c[4]],f=[c[1],c[3],c[5]],vec3.transformMat4(e,e,b),vec3.transformMat4(f,f,b),g=[e[0]>f[0]?f[0]:e[0],e[0]>f[0]?e[0]:f[0],e[1]>f[1]?f[1]:e[1],e[1]>f[1]?e[1]:f[1],e[2]>f[2]?f[2]:e[2],e[2]>f[2]?e[2]:f[2]],a.setBounds(g[0],g[1],g[2],g[3],g[4],g[5]),h.modified())},a},inherit(vgl.actor,vgl.node),vgl.freezeObject=function(a){"use strict";var b=Object.freeze(a);return"undefined"==typeof b&&(b=function(a){return a}),b},vgl.defaultValue=function(a,b){"use strict";return"undefined"!=typeof a?a:b},vgl.defaultValue.EMPTY_OBJECT=vgl.freezeObject({}),vgl.graphicsObject=function(a){"use strict";if(a=a,!(this instanceof vgl.graphicsObject))return new vgl.graphicsObject;vgl.object.call(this);var b=this;return this._setup=function(a){return a=a,!1},this._cleanup=function(a){return a=a,!1},this.bind=function(a){return a=a,!1},this.undoBind=function(a){return a=a,!1},this.render=function(a){return a=a,!1},this.remove=function(a){b._cleanup(a)},b},inherit(vgl.graphicsObject,vgl.object),vgl.geojsonReader=function(){"use strict";return this instanceof vgl.geojsonReader?(this.readScalars=function(a,b,c,d){var e=null,f=null,g=null,h=null,i=null;"values"===this.m_scalarFormat&&4===a.length?(f=a[3],e=b.sourceData(vgl.vertexAttributeKeys.Scalar),e||(e=new vgl.sourceDataSf,this.m_scalarRange&&e.setScalarRange(this.m_scalarRange[0],this.m_scalarRange[1]),void 0!==c&&(e.data().length=c),b.addSource(e)),void 0===c?e.pushBack(f):e.insertAt(d,f)):"rgb"===this.m_scalarFormat&&6===a.length&&(e=b.sourceData(vgl.vertexAttributeKeys.Color),e||(e=new vgl.sourceDataC3fv,void 0!==c&&(e.length=3*c),b.addSource(e)),g=a[3],h=a[4],i=a[5],void 0===c?e.pushBack([g,h,i]):e.insertAt(d,[g,h,i]))},this.readPoint=function(a){var b=new vgl.geometryData,c=new vgl.points,d=new vgl.sourceDataP3fv,e=new Uint16Array(1),f=null,g=null,h=null,i=null;for(b.addSource(d),i=0;1>i;i+=1)e[i]=i,f=a[0],g=a[1],h=0,a.length>2&&(h=a[2]),d.pushBack([f,g,h]),this.readScalars(a,b);return c.setIndices(e),b.addPrimitive(c),b.setName("aPoint"),b},this.readMultiPoint=function(a){var b,c=new vgl.geometryData,d=new vgl.points,e=new vgl.sourceDataP3fv,f=new Uint16Array(a.length),g=0,h=a.length,i=null,j=null,k=null;for(e.data().length=3*h,b=0;b<a.length;b+=1)f[b]=b,i=a[b][0],j=a[b][1],k=0,a[b].length>2&&(k=a[b][2]),e.insertAt(g,[i,j,k]),this.readScalars(a[b],c,h,g),g+=1;return d.setIndices(f),c.addPrimitive(d),c.addSource(e),c.setName("manyPoints"),c},this.readLineString=function(a){var b=new vgl.geometryData,c=new vgl.lineStrip,d=new vgl.sourceDataP3fv,e=[],f=null,g=null,h=null,i=null;for(c.setIndicesPerPrimitive(a.length),f=0;f<a.length;f+=1)e.push(f),g=a[f][0],h=a[f][1],i=0,a[f].length>2&&(i=a[f][2]),d.pushBack([g,h,i]),this.readScalars(a[f],b);return c.setIndices(e),b.addPrimitive(c),b.addSource(d),b.setName("aLineString"),b},this.readMultiLineString=function(a){var b=new vgl.geometryData,c=new vgl.sourceDataP3fv,d=0,e=2*a.length,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null;for(c.data().length=3*e,g=0;g<a.length;g+=1){for(k=[],l=new vgl.lineStrip,m=a[g].length,l.setIndicesPerPrimitive(m),f=0;m>f;f+=1)k.push(d),h=a[g][f][0],i=a[g][f][1],j=0,a[g][f].length>2&&(j=a[g][f][2]),c.insertAt(d,[h,i,j]),this.readScalars(a[g][f],b,2*e,d),d+=1;l.setIndices(k),b.addPrimitive(l)}return b.setName("aMultiLineString"),b.addSource(c),b},this.readPolygon=function(a){var b=new vgl.geometryData,c=new vgl.sourceDataP3fv,d=null,e=null,f=null,g=a[0].length,h=1,i=null,j=null,k=null;for(i=0;g>i;i+=1)d=a[0][i][0],e=a[0][i][1],f=0,a[0][i].length>2&&(f=a[0][i][2]),c.pushBack([d,e,f]),this.readScalars(a[0][i],b),i>1&&(j=new Uint16Array([0,h,i]),k=new vgl.triangles,k.setIndices(j),b.addPrimitive(k),h=i);return b.setName("POLY"),b.addSource(c),b},this.readMultiPolygon=function(a){var b=new vgl.geometryData,c=new vgl.sourceDataP3fv,d=0,e=a.length,f=0,g=3*e,h=new vgl.triangles,i=[],j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=!1,t=0;for(c.data().length=3*e,k=0;e>k;k+=1)for(o=a[k][0].length,p=d,q=d+1,r=[!1,!1,!1],j=0;o>j;j+=1)l=a[k][0][j][0],m=a[k][0][j][1],n=0,a[k][0][j].length>2&&(n=a[k][0][j][2]),s=!1,l>180&&(s=!0,l-=360),0===j?r[0]=s:r[1+(j-1)%2]=s,c.insertAt(f,[l,m,n]),this.readScalars(a[k][0][j],b,g,f),f+=1,j>1&&(r[0]===r[1]&&r[1]===r[2]&&(i[3*t+0]=p,i[3*t+1]=q,i[3*t+2]=d,t+=1),q=d),d+=1;return h.setIndices(i),b.addPrimitive(h),b.setName("aMultiPoly"),b.addSource(c),b},this.readGJObjectInt=function(a){if(!a.hasOwnProperty("type"))return null;a.properties&&a.properties.ScalarFormat&&"values"===a.properties.ScalarFormat&&(this.m_scalarFormat="values",a.properties.ScalarRange&&(this.m_scalarRange=a.properties.ScalarRange)),a.properties&&a.properties.ScalarFormat&&"rgb"===a.properties.ScalarFormat&&(this.m_scalarFormat="rgb");var b,c=a.type,d=null,e=null,f=null;switch(c){case"Point":b=this.readPoint(a.coordinates);break;case"MultiPoint":b=this.readMultiPoint(a.coordinates);break;case"LineString":b=this.readLineString(a.coordinates);break;case"MultiLineString":b=this.readMultiLineString(a.coordinates);break;case"Polygon":b=this.readPolygon(a.coordinates);break;case"MultiPolygon":b=this.readMultiPolygon(a.coordinates);break;case"GeometryCollection":for(e=[],f=0;f<a.geometries.length;f+=1)d=this.readGJObject(a.geometries[f]),e.push(d);b=e;break;case"Feature":d=this.readGJObject(a.geometry),b=d;break;case"FeatureCollection":for(e=[],f=0;f<a.features.length;f+=1)d=this.readGJObject(a.features[f]),e.push(d);b=e;break;default:console.log("Don't understand type "+c),b=null}return b},this.readGJObject=function(a){var b;return b=this.readGJObjectInt(a)},this.linearizeGeoms=function(a,b){var c=null;if("[object Array]"===Object.prototype.toString.call(b))for(c=0;c<b.length;c+=1)this.linearizeGeoms(a,b[c]);else a.push(b)},this.readGeomObject=function(a){var b,c=[];return b=this.readGJObject(a),this.linearizeGeoms(c,b),c},this.getPrimitives=function(a){if(!a)return[];var b=JSON.parse(a),c=this.readGJObject(b),d=[];return this.m_scalarFormat="none",this.m_scalarRange=null,this.linearizeGeoms(d,c),{geoms:d,scalarFormat:this.m_scalarFormat,scalarRange:this.m_scalarRange}},this):new vgl.geojsonReader},vgl.data=function(){"use strict";return this instanceof vgl.data?void(this.type=function(){}):new vgl.data},vgl.data.raster=0,vgl.data.point=1,vgl.data.lineString=2,vgl.data.polygon=3,vgl.data.geometry=10,vgl.primitive=function(){"use strict";if(!(this instanceof vgl.primitive))return new vgl.primitive;var a=0,b=0,c=0,d=null;return this.indices=function(){return d},this.createIndices=function(a){a=a,d=new Uint16Array},this.numberOfIndices=function(){return d.length},this.sizeInBytes=function(){return d.length*Uint16Array.BYTES_PER_ELEMENT},this.primitiveType=function(){return b},this.setPrimitiveType=function(a){b=a},this.indicesPerPrimitive=function(){return a},this.setIndicesPerPrimitive=function(b){a=b},this.indicesValueType=function(){return c},this.setIndicesValueType=function(a){c=a},this.setIndices=function(a){d=new Uint16Array(a)},this},vgl.triangleStrip=function(){"use strict";return this instanceof vgl.triangleStrip?(vgl.primitive.call(this),this.setPrimitiveType(vgl.GL.TRIANGLE_STRIP),this.setIndicesValueType(vgl.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(3),this):new vgl.triangleStrip},inherit(vgl.triangleStrip,vgl.primitive),vgl.triangles=function(){"use strict";return this instanceof vgl.triangles?(vgl.primitive.call(this),this.setPrimitiveType(vgl.GL.TRIANGLES),this.setIndicesValueType(vgl.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(3),this):new vgl.triangles},inherit(vgl.triangles,vgl.primitive),vgl.lines=function(){"use strict";return this instanceof vgl.lines?(vgl.primitive.call(this),this.setPrimitiveType(vgl.GL.LINES),this.setIndicesValueType(vgl.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(2),this):new vgl.lines},inherit(vgl.lines,vgl.primitive),vgl.lineStrip=function(){"use strict";return this instanceof vgl.lineStrip?(vgl.primitive.call(this),this.setPrimitiveType(vgl.GL.LINE_STRIP),this.setIndicesValueType(vgl.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(2),this):new vgl.lineStrip},inherit(vgl.lineStrip,vgl.primitive),vgl.points=function(){"use strict";return this instanceof vgl.points?(vgl.primitive.call(this),this.setPrimitiveType(vgl.GL.POINTS),this.setIndicesValueType(vgl.GL.UNSIGNED_SHORT),this.setIndicesPerPrimitive(1),this):new vgl.points},inherit(vgl.points,vgl.primitive),vgl.vertexDataP3f=function(){"use strict";return this instanceof vgl.vertexDataP3f?(this.m_position=[],this):new vgl.vertexDataP3f},vgl.vertexDataP3N3f=function(){"use strict";return this instanceof vgl.vertexDataP3N3f?(this.m_position=[],this.m_normal=[],this):new vgl.vertexDataP3N3f},vgl.vertexDataP3T3f=function(){"use strict";return this instanceof vgl.vertexDataP3T3f?(this.m_position=[],this.m_texCoordinate=[],this):new vgl.vertexDataP3T3f},vgl.sourceData=function(a){"use strict";if(!(this instanceof vgl.sourceData))return new vgl.sourceData(a);a=a||{};var b={},c=[],d=a.name||"Source "+(new Date).toISOString(),e=function(){this.m_numberOfComponents=0,this.m_dataType=0,this.m_dataTypeSize=0,this.m_normalized=!1,this.m_stride=0,this.m_offset=0};return this.data=function(){return c},this.getData=function(){return this.data()},this.dataToFloat32Array=function(){return c instanceof Float32Array||(c=new Float32Array(c)),c},this.setData=function(a){return a instanceof Array||a instanceof Float32Array?void(c=a instanceof Float32Array?a:a.slice(0)):void console.log("[error] Requires array")},this.addAttribute=function(a,c,d,f,g,h,i){if(!b.hasOwnProperty(a)){var j=new e;j.m_dataType=c,j.m_dataTypeSize=d,j.m_offset=f,j.m_stride=g,j.m_numberOfComponents=h,j.m_normalized=i,b[a]=j}},this.sizeOfArray=function(){return Object.size(c)},this.lengthOfArray=function(){return c.length},this.sizeInBytes=function(){var a,b=0,c=this.keys();for(a=0;a<c.length();a+=1)b+=this.numberOfComponents(c[a])*this.sizeOfAttributeDataType(c[a]);return b*=this.sizeOfArray()},this.hasKey=function(a){return b.hasOwnProperty(a)},this.keys=function(){return Object.keys(b)},this.numberOfAttributes=function(){return Object.size(b)},this.attributeNumberOfComponents=function(a){return b.hasOwnProperty(a)?b[a].m_numberOfComponents:0},this.normalized=function(a){return b.hasOwnProperty(a)?b[a].m_normalized:!1},this.sizeOfAttributeDataType=function(a){return b.hasOwnProperty(a)?b[a].m_dataTypeSize:0},this.attributeDataType=function(a){return b.hasOwnProperty(a)?b[a].m_dataType:void 0},this.attributeOffset=function(a){return b.hasOwnProperty(a)?b[a].m_offset:0},this.attributeStride=function(a){return b.hasOwnProperty(a)?b[a].m_stride:0},this.pushBack=function(a){a=a},this.insert=function(a){var b;if(!c.length&&a.length&&a instanceof Float32Array)return void(c=a);if(c.slice||!c.length&&a.slice||(c=Array.prototype.slice.call(c)),a.length)if(!c.length&&a.slice)c=a.slice(0);else for(b=0;b<a.length;b+=1)c[c.length]=a[b];else c[c.length]=a},this.insertAt=function(a,b){var d;if(b.length)for(d=0;d<b.length;d+=1)c[a*b.length+d]=b[d];else c[a]=b},this.name=function(){return d},this.setName=function(a){d=a},this},vgl.sourceDataAnyfv=function(a,b,c){"use strict";return this instanceof vgl.sourceDataAnyfv?(vgl.sourceData.call(this,c),this.addAttribute(b,vgl.GL.FLOAT,4,0,4*a,a,!1),this.pushBack=function(a){this.insert(a)},this):new vgl.sourceDataAnyfv(a,b,c)},inherit(vgl.sourceDataAnyfv,vgl.sourceData),vgl.sourceDataP3T3f=function(a){"use strict";return this instanceof vgl.sourceDataP3T3f?(vgl.sourceData.call(this,a),this.addAttribute(vgl.vertexAttributeKeys.Position,vgl.GL.FLOAT,4,0,24,3,!1),this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate,vgl.GL.FLOAT,4,12,24,3,!1),this.pushBack=function(a){this.insert(a.m_position),this.insert(a.m_texCoordinate)},this):new vgl.sourceDataP3T3f(a)},inherit(vgl.sourceDataP3T3f,vgl.sourceData),vgl.sourceDataP3N3f=function(a){"use strict";return this instanceof vgl.sourceDataP3N3f?(vgl.sourceData.call(this,a),this.addAttribute(vgl.vertexAttributeKeys.Position,vgl.GL.FLOAT,4,0,24,3,!1),this.addAttribute(vgl.vertexAttributeKeys.Normal,vgl.GL.FLOAT,4,12,24,3,!1),this.pushBack=function(a){this.insert(a.m_position),this.insert(a.m_normal)},this):new vgl.sourceDataP3N3f(a)},inherit(vgl.sourceDataP3N3f,vgl.sourceData),vgl.sourceDataP3fv=function(a){"use strict";return this instanceof vgl.sourceDataP3fv?(vgl.sourceData.call(this,a),this.addAttribute(vgl.vertexAttributeKeys.Position,vgl.GL.FLOAT,4,0,12,3,!1),this.pushBack=function(a){this.insert(a)},this):new vgl.sourceDataP3fv(a)},inherit(vgl.sourceDataP3fv,vgl.sourceData),vgl.sourceDataT2fv=function(a){"use strict";return this instanceof vgl.sourceDataT2fv?(vgl.sourceData.call(this,a),this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate,vgl.GL.FLOAT,4,0,8,2,!1),this.pushBack=function(a){this.insert(a)},this):new vgl.sourceDataT2fv(a)},inherit(vgl.sourceDataT2fv,vgl.sourceData),vgl.sourceDataC3fv=function(a){"use strict";return this instanceof vgl.sourceDataC3fv?(vgl.sourceData.call(this,a),this.addAttribute(vgl.vertexAttributeKeys.Color,vgl.GL.FLOAT,4,0,12,3,!1),this.pushBack=function(a){this.insert(a)},this):new vgl.sourceDataC3fv(a)},inherit(vgl.sourceDataC3fv,vgl.sourceData),vgl.sourceDataSf=function(a){"use strict";if(!(this instanceof vgl.sourceDataSf))return new vgl.sourceDataSf(a);var b=null,c=null,d=null,e=null;return vgl.sourceData.call(this,a),this.addAttribute(vgl.vertexAttributeKeys.Scalar,vgl.GL.FLOAT,4,0,4,1,!1),this.pushBack=function(a){(null===c||a>c)&&(c=a),(null===b||b>a)&&(b=a),this.data()[this.data().length]=a},this.insertAt=function(a,d){(null===c||d>c)&&(c=d),(null===b||b>d)&&(b=d),this.data()[a]=d},this.scalarRange=function(){return null===d||null===e?[b,c]:[d,e]},this.setScalarRange=function(a,b){d=a,e=b},this},inherit(vgl.sourceDataSf,vgl.sourceData),vgl.sourceDataDf=function(a){"use strict";return this instanceof vgl.sourceDataDf?(vgl.sourceData.call(this,a),this.addAttribute(vgl.vertexAttributeKeys.Scalar,vgl.GL.FLOAT,4,0,4,1,!1),this.pushBack=function(a){this.data()[this.data().length]=a},this.insertAt=function(a,b){this.data()[a]=b},this):new vgl.sourceDataDf(a)},inherit(vgl.sourceDataDf,vgl.sourceData),vgl.geometryData=function(){"use strict";if(!(this instanceof vgl.geometryData))return new vgl.geometryData;vgl.data.call(this);var a="",b=[],c=[],d=[0,0,0,0,0,0],e=vgl.timestamp(),f=vgl.timestamp();return this.type=function(){return vgl.data.geometry},this.name=function(){return a},this.setName=function(b){a=b},this.addSource=function(a,b){return void 0!==b&&a.setName(b),-1===c.indexOf(a)?(c.push(a),a.hasKey(vgl.vertexAttributeKeys.Position)&&f.modified(),!0):!1},this.source=function(a){return a<c.length?c[a]:0},this.sourceByName=function(a){for(var b=0;b<c.length;b+=1)if(c[b].name()===a)return c[b];return 0},this.numberOfSources=function(){return c.length},this.sourceData=function(a){var b;for(b=0;b<c.length;b+=1)if(c[b].hasKey(a))return c[b];return null},this.addPrimitive=function(a){return b.push(a),!0},this.primitive=function(a){return a<b.length?b[a]:null},this.numberOfPrimitives=function(){return b.length},this.bounds=function(){return f.getMTime()>e.getMTime()&&this.computeBounds(),d},this.boundsDirty=function(a){return a&&f.modified(),f.getMTime()>e.getMTime()},this.resetBounds=function(){d[0]=0,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=0},this.setBounds=function(a,b,c,f,g,h){return d[0]=a,d[1]=b,d[2]=c,d[3]=f,d[4]=g,d[5]=h,e.modified(),!0},this.computeBounds=function(){if(f.getMTime()>e.getMTime()){var a,b,c,g,h,i,j=vgl.vertexAttributeKeys.Position,k=this.sourceData(j),l=k.data(),m=k.attributeNumberOfComponents(j),n=k.attributeStride(j),o=k.attributeOffset(j),p=k.sizeOfAttributeDataType(j),q=l.length,r=null;for(n/=p,o/=p,this.resetBounds(),a=0;m>a;a+=1){for(b=2*a,c=2*a+1,g=h=q?d[c]=l[o+a]:0,i=o+n+a;q>i;i+=n)r=l[i],r>g&&(g=r),h>r&&(h=r);d[b]=h,d[c]=g}e.modified()}},this.findClosestVertex=function(a){var b,c,d,e,f,g,h,i=vgl.vertexAttributeKeys.Position,j=this.sourceData(i),k=j.sizeOfAttributeDataType(i),l=j.attributeNumberOfComponents(i),m=j.data(),n=j.attributeStride(i)/k,o=j.attributeOffset(i)/k,p=Number.MAX_VALUE,q=null;for(3!==l&&console.log("[warning] Find closest vertex assumes threecomponent vertex "),a.z||(a={x:a.x,y:a.y,z:0}),b=o,h=0;b<m.length;b+=n,h+=1)c=[m[b],m[b+1],m[b+2]],d=c[0]-a.x,e=c[1]-a.y,f=c[2]-a.z,g=Math.sqrt(d*d+e*e+f*f),p>g&&(p=g,q=h);return q},this.getPosition=function(a){var b=vgl.vertexAttributeKeys.Position,c=this.sourceData(b),d=c.sizeOfAttributeDataType(b),e=c.attributeNumberOfComponents(b),f=c.data(),g=c.attributeStride(b)/d,h=c.attributeOffset(b)/d;return 3!==e&&console.log("[warning] getPosition assumes three component data"),[f[h+a*g],f[h+a*g+1],f[h+a*g+2]]},this.getScalar=function(a){var b,c,d,e,f,g=vgl.vertexAttributeKeys.Scalar,h=this.sourceData(g);return h?(b=h.attributeNumberOfComponents(g),c=h.sizeOfAttributeDataType(g),d=h.data(),e=h.attributeStride(g)/c,f=h.attributeOffset(g)/c,a*e+f>=d.length&&console.log("access out of bounds in getScalar"),d[a*e+f]):null},this},inherit(vgl.geometryData,vgl.data),vgl.mapper=function(a){"use strict";function b(a){if(g){a&&(l=a.m_context);var b,c,d,e,f,m,n,o=g.numberOfSources(),p=null;for(b=0;o>b;b+=1){for(p=l.createBuffer(),l.bindBuffer(vgl.GL.ARRAY_BUFFER,p),n=g.source(b).data(),n instanceof Float32Array||(n=new Float32Array(n)),l.bufferData(vgl.GL.ARRAY_BUFFER,n,j?vgl.GL.DYNAMIC_DRAW:vgl.GL.STATIC_DRAW),e=g.source(b).keys(),f=[],c=0;c<e.length;c+=1)f.push(e[c]);i[b]=f,h[b]=p}for(m=g.numberOfPrimitives(),d=0;m>d;d+=1)p=l.createBuffer(),l.bindBuffer(vgl.GL.ARRAY_BUFFER,p),l.bufferData(vgl.GL.ARRAY_BUFFER,g.primitive(d).indices(),vgl.GL.STATIC_DRAW),h[b]=p,b+=1;k.modified()}}function c(a){a=a,i={},h=[]}function d(a){m.deleteVertexBufferObjects(a),c(a),b(a),e=!1}if(!(this instanceof vgl.mapper))return new vgl.mapper(a);vgl.boundingObject.call(this),a=a||{};var e=!0,f=[0,1,1],g=null,h=[],i={},j=void 0===a.dynamicDraw?!1:a.dynamicDraw,k=vgl.timestamp(),l=null,m=this;return this.deleteVertexBufferObjects=function(a){var b,c=l;if(a&&(c=a.m_context),c)for(b=0;b<h.length;b+=1)c.deleteBuffer(h[b])},this.computeBounds=function(){if(null===g||"undefined"==typeof g)return void this.resetBounds();var a=this.computeBoundsTimestamp(),b=this.boundsDirtyTimestamp(),c=null;b.getMTime()>a.getMTime()&&(c=g.bounds(),this.setBounds(c[0],c[1],c[2],c[3],c[4],c[5]),a.modified())},this.color=function(){return f},this.setColor=function(a,b,c){f[0]=a,f[1]=b,f[2]=c,this.modified()},this.geometryData=function(){return g},this.setGeometryData=function(a){g!==a&&(g=a,this.modified(),this.boundsDirtyTimestamp().modified())},this.updateSourceBuffer=function(a,b,c){if(c&&(l=c.m_context),!l)return!1;for(var d=-1,e=0;e<g.numberOfSources();e+=1)if(g.source(e).name()===a){d=e;break}return 0>d||d>=h.length?!1:(b||(b=g.source(e).dataToFloat32Array()),
l.bindBuffer(vgl.GL.ARRAY_BUFFER,h[d]),b instanceof Float32Array?l.bufferSubData(vgl.GL.ARRAY_BUFFER,0,b):l.bufferSubData(vgl.GL.ARRAY_BUFFER,0,new Float32Array(b)),!0)},this.getSourceBuffer=function(a){var b=g.sourceByName(a);return b?b.dataToFloat32Array():new Float32Array},this.render=function(a){(this.getMTime()>k.getMTime()||a.m_contextChanged)&&d(a),l=a.m_context,l.vertexAttrib3fv(vgl.vertexAttributeKeys.Color,this.color());var b,c=0,e=0,f=null,j=null;for(b in i)if(i.hasOwnProperty(b)){for(l.bindBuffer(vgl.GL.ARRAY_BUFFER,h[c]),e=0;e<i[b].length;e+=1)a.m_material.bindVertexData(a,i[b][e]);c+=1}for(f=g.numberOfPrimitives(),e=0;f>e;e+=1){switch(l.bindBuffer(vgl.GL.ARRAY_BUFFER,h[c]),c+=1,j=g.primitive(e),j.primitiveType()){case vgl.GL.POINTS:l.drawArrays(vgl.GL.POINTS,0,j.numberOfIndices());break;case vgl.GL.LINES:l.drawArrays(vgl.GL.LINES,0,j.numberOfIndices());break;case vgl.GL.LINE_STRIP:l.drawArrays(vgl.GL.LINE_STRIP,0,j.numberOfIndices());break;case vgl.GL.TRIANGLES:l.drawArrays(vgl.GL.TRIANGLES,0,j.numberOfIndices());break;case vgl.GL.TRIANGLE_STRIP:l.drawArrays(vgl.GL.TRIANGLE_STRIP,0,j.numberOfIndices())}l.bindBuffer(vgl.GL.ARRAY_BUFFER,null)}},this},inherit(vgl.mapper,vgl.boundingObject),vgl.groupMapper=function(){"use strict";if(!(this instanceof vgl.groupMapper))return new vgl.groupMapper;vgl.mapper.call(this);var a=vgl.timestamp(),b=[],c=[];return this.geometryData=function(a){return void 0!==a&&a<c.length?c[a]:c.length>0?c[0]:null},this.setGeometryData=function(a){(1!==c.length||c[0]!==a)&&(c=[],c.push(a),this.modified())},this.geometryDataArray=function(){return c},this.setGeometryDataArray=function(a){if(a instanceof Array){if(c!==a)return c=[],c=a,this.modified(),!0}else console.log("[error] Requies array of geometry data");return!1},this.computeBounds=function(){if(null===c||void 0===c)return void this.resetBounds();var a=this.computeBoundsTimestamp(),b=this.boundsDirtyTimestamp(),d=this.bounds(),e=null,f=null;if(b.getMTime()>a.getMTime()){for(f=0;f<c.length;f+=1)e=c[f].bounds(),d[0]>e[0]&&(d[0]=e[0]),d[1]<e[1]&&(d[1]=e[1]),d[2]>e[2]&&(d[2]=e[2]),d[3]<e[3]&&(d[3]=e[3]),d[4]>e[4]&&(d[4]=e[4]),d[5]<e[5]&&(d[5]=e[5]);this.modified(),a.modified()}},this.render=function(d){var e=null;if(this.getMTime()>a.getMTime()){for(e=0;e<c.length;e+=1)b.push(vgl.mapper()),b[e].setGeometryData(c[e]);a.modified()}for(e=0;e<b.length;e+=1)b[e].render(d)},this},inherit(vgl.groupMapper,vgl.mapper),vgl.materialAttributeType={Undefined:0,ShaderProgram:1,Texture:2,Blend:3,Depth:4},vgl.materialAttribute=function(a){"use strict";if(!(this instanceof vgl.materialAttribute))return new vgl.materialAttribute;vgl.graphicsObject.call(this);var b=this,c=a,d=!0;return this.type=function(){return c},this.enabled=function(){return d},this.bindVertexData=function(a,b){return a=a,b=b,!1},this.undoBindVertexData=function(a,b){return a=a,b=b,!1},b},inherit(vgl.materialAttribute,vgl.graphicsObject),vgl.blendFunction=function(a,b){"use strict";if(!(this instanceof vgl.blendFunction))return new vgl.blendFunction(a,b);var c=a,d=b;return this.apply=function(a){a.m_context.blendFuncSeparate(c,d,vgl.GL.ONE,vgl.GL.ONE_MINUS_SRC_ALPHA)},this},vgl.blend=function(){"use strict";if(!(this instanceof vgl.blend))return new vgl.blend;vgl.materialAttribute.call(this,vgl.materialAttributeType.Blend);var a=!1,b=vgl.blendFunction(vgl.GL.SRC_ALPHA,vgl.GL.ONE_MINUS_SRC_ALPHA);return this.bind=function(c){return a=c.m_context.isEnabled(vgl.GL.BLEND),this.enabled()?(c.m_context.enable(vgl.GL.BLEND),b.apply(c)):c.m_context.disable(vgl.GL.BLEND),!0},this.undoBind=function(b){return a?b.m_context.enable(vgl.GL.BLEND):b.m_context.disable(vgl.GL.BLEND),!0},this},inherit(vgl.blend,vgl.materialAttribute),vgl.material=function(){"use strict";if(!(this instanceof vgl.material))return new vgl.material;vgl.graphicsObject.call(this);var a=this,b=new vgl.shaderProgram,c=100,d={},e={};return this.binNumber=function(){return c},this.setBinNumber=function(b){c=b,a.modified()},this.exists=function(a){return a.type()===vgl.materialAttribute.Texture?d.hasOwnProperty(a):e.hasOwnProperty(a)},this.uniform=function(a){return b?b.uniform(a):null},this.attribute=function(a){return e.hasOwnProperty(a)?e[a]:d.hasOwnProperty(a)?d[a]:null},this.setAttribute=function(c){return c.type()===vgl.materialAttributeType.Texture&&d[c.textureUnit()]!==c?(d[c.textureUnit()]=c,a.modified(),!0):e[c.type()]===c?!1:(c.type()===vgl.materialAttributeType.ShaderProgram&&(b=c),e[c.type()]=c,a.modified(),!0)},this.addAttribute=function(c){return a.exists(c)?!1:c.type()===vgl.materialAttributeType.Texture?(d[c.textureUnit()]=c,a.modified(),!0):(c.type()===vgl.materialAttributeType.ShaderProgram&&(b=c),e[c.type()]=c,a.modified(),!0)},this.shaderProgram=function(){return b},this._setup=function(a){return a=a,!1},this._cleanup=function(a){for(var b in e)e.hasOwnProperty(b)&&e[b]._cleanup(a);for(b in d)d.hasOwnProperty(b)&&d[b]._cleanup(a)},this.bind=function(a){var c=null;b.bind(a);for(c in e)e.hasOwnProperty(c)&&e[c]!==b&&e[c].bind(a);for(c in d)d.hasOwnProperty(c)&&d[c].bind(a)},this.undoBind=function(a){var b=null;for(b in e)e.hasOwnProperty(b)&&e[b].undoBind(a);for(b in d)d.hasOwnProperty(b)&&d[b].undoBind(a)},this.bindVertexData=function(a,b){var c=null;for(c in e)e.hasOwnProperty(c)&&e[c].bindVertexData(a,b)},this.undoBindVertexData=function(a,b){var c=null;for(c in e)e.hasOwnProperty(c)&&e.undoBindVertexData(a,b)},a},vgl.material.RenderBin={Base:0,Default:100,Opaque:100,Transparent:1e3,Overlay:1e4},inherit(vgl.material,vgl.graphicsObject),vgl.renderState=function(){"use strict";this.m_context=null,this.m_modelViewMatrix=mat4.create(),this.m_normalMatrix=mat4.create(),this.m_projectionMatrix=null,this.m_material=null,this.m_mapper=null},vgl.renderer=function(a){"use strict";if(!(this instanceof vgl.renderer))return new vgl.renderer(a);vgl.graphicsObject.call(this),a=a||{};var b=this;return b.m_renderWindow=null,b.m_contextChanged=!1,b.m_sceneRoot=new vgl.groupNode,b.m_camera=new vgl.camera(a),b.m_nearClippingPlaneTolerance=null,b.m_x=0,b.m_y=0,b.m_width=0,b.m_height=0,b.m_resizable=!0,b.m_resetScene=!0,b.m_layer=0,b.m_renderPasses=null,b.m_resetClippingRange=!0,b.m_depthBits=null,b.m_camera.addChild(b.m_sceneRoot),this.width=function(){return b.m_width},this.height=function(){return b.m_height},this.layer=function(){return b.m_layer},this.setLayer=function(a){b.m_layer=a,b.modified()},this.isResizable=function(){return b.m_resizable},this.setResizable=function(a){b.m_resizable=a},this.renderWindow=function(){return b.m_renderWindow},this.setRenderWindow=function(a){b.m_renderWindow!==a&&(b.m_renderWindow&&b.m_renderWindow.removeRenderer(this),b.m_renderWindow=a,b.m_contextChanged=!0,b.modified())},this.backgroundColor=function(){return b.m_camera.clearColor()},this.setBackgroundColor=function(a,c,d,e){b.m_camera.setClearColor(a,c,d,e),b.modified()},this.sceneRoot=function(){return b.m_sceneRoot},this.camera=function(){return b.m_camera},this.render=function(){var a,c,d,e=null,f=[],g=mat4.create(),h=null;if(c=new vgl.renderState,c.m_renderer=b,c.m_context=b.renderWindow().context(),(!b.m_depthBits||b.m_contextChanged)&&(b.m_depthBits=c.m_context.getParameter(vgl.GL.DEPTH_BITS)),c.m_contextChanged=b.m_contextChanged,b.m_renderPasses)for(a=0;a<b.m_renderPasses.length;a+=1){if(b.m_renderPasses[a].render(c))return console.log("returning"),void b.m_renderPasses[a].remove(c);b.m_renderPasses[a].remove(c)}for(c.m_context.enable(vgl.GL.DEPTH_TEST),c.m_context.depthFunc(vgl.GL.LEQUAL),b.m_camera.clearMask()&vgl.GL.COLOR_BUFFER_BIT&&(h=b.m_camera.clearColor(),c.m_context.clearColor(h[0],h[1],h[2],h[3])),b.m_camera.clearMask()&vgl.GL.DEPTH_BUFFER_BIT&&c.m_context.clearDepth(b.m_camera.clearDepth()),c.m_context.clear(b.m_camera.clearMask()),c.m_context.viewport(b.m_x,b.m_y,b.m_width,b.m_height),d=b.m_sceneRoot.children(),d.length>0&&b.m_resetScene&&(b.resetCamera(),b.m_resetScene=!1),a=0;a<d.length;a+=1)e=d[a],e.computeBounds(),e.visible()&&e.material().binNumber()>=0&&f.push([e.material().binNumber(),e]);for(f.sort(function(a,b){return a[0]-b[0]}),a=0;a<f.length;a+=1){if(e=f[a][1],e.referenceFrame()===vgl.boundingObject.ReferenceFrame.Relative){var i=b.m_camera.viewMatrix();i instanceof Array&&(c.m_modelViewMatrix=new Array(16)),mat4.multiply(c.m_modelViewMatrix,i,e.matrix()),c.m_projectionMatrix=b.m_camera.projectionMatrix(),c.m_modelViewAlignment=b.m_camera.viewAlignment()}else c.m_modelViewMatrix=e.matrix(),c.m_modelViewAlignment=null,c.m_projectionMatrix=mat4.create(),mat4.ortho(c.m_projectionMatrix,0,b.m_width,0,b.m_height,-1,1);mat4.invert(g,c.m_modelViewMatrix),mat4.transpose(c.m_normalMatrix,g),c.m_material=e.material(),c.m_mapper=e.mapper(),c.m_material.bind(c),c.m_mapper.render(c),c.m_material.undoBind(c)}c.m_context.finish(),b.m_contextChanged=!1},this.resetCamera=function(){b.m_camera.computeBounds();var a=b.m_camera.directionOfProjection(),c=b.m_camera.bounds(),d=[(c[0]+c[1])/2,(c[2]+c[3])/2,(c[4]+c[5])/2],e=[c[1]-c[0],c[3]-c[2],c[5]-c[4]],f=0,g=b.m_camera.viewAspect(),h=b.m_camera.viewAngle(),i=null,j=null;f=e[0]>e[1]?e[0]>e[2]?e[0]/2:e[2]/2:e[1]>e[2]?e[1]/2:e[2]/2,h=g>=1?2*Math.atan(Math.tan(.5*h)/g):2*Math.atan(Math.tan(.5*h)*g),i=f/Math.sin(.5*h),j=b.m_camera.viewUpDirection(),Math.abs(vec3.dot(j,a))>.999&&b.m_camera.setViewUpDirection(-j[2],j[0],j[1]),b.m_camera.setFocalPoint(d[0],d[1],d[2]),b.m_camera.setPosition(d[0]+i*-a[0],d[1]+i*-a[1],d[2]+i*-a[2]),b.resetCameraClippingRange(c)},this.hasValidBounds=function(a){return a[0]===Number.MAX_VALUE||a[1]===-Number.MAX_VALUE||a[2]===Number.MAX_VALUE||a[3]===-Number.MAX_VALUE||a[4]===Number.MAX_VALUE||a[5]===-Number.MAX_VALUE?!1:!0},this.resetCameraClippingRange=function(a){if("undefined"==typeof a&&(b.m_camera.computeBounds(),a=b.m_camera.bounds()),b.hasValidBounds(a)){var c=b.m_camera.viewPlaneNormal(),d=b.m_camera.position(),e=-c[0],f=-c[1],g=-c[2],h=-(e*d[0]+f*d[1]+g*d[2]),i=vec2.create(),j=null,k=null,l=null,m=null;if(b.m_resetClippingRange){for(i[0]=e*a[0]+f*a[2]+g*a[4]+h,i[1]=1e-18,m=0;2>m;m+=1)for(l=0;2>l;l+=1)for(k=0;2>k;k+=1)j=e*a[k]+f*a[2+l]+g*a[4+m]+h,i[0]=j<i[0]?j:i[0],i[1]=j>i[1]?j:i[1];i[0]<0&&(i[0]=0),i[0]=.99*i[0]-.5*(i[1]-i[0]),i[1]=1.01*i[1]+.5*(i[1]-i[0]),i[0]=i[0]>=i[1]?.01*i[1]:i[0],b.m_nearClippingPlaneTolerance||(b.m_nearClippingPlaneTolerance=.01,b.m_depthBits&&b.m_depthBits>16&&(b.m_nearClippingPlaneTolerance=.001)),i[0]<b.m_nearClippingPlaneTolerance*i[1]&&(i[0]=b.m_nearClippingPlaneTolerance*i[1]),b.m_camera.setClippingRange(i[0],i[1])}}},this.resize=function(a,c){a&&c&&b.positionAndResize(b.m_x,b.m_y,a,c)},this.positionAndResize=function(a,c,d,e){var f;if(0>a||0>c||0>=d||0>=e)return void console.log("[error] Invalid position and resize values",a,c,d,e);if(b.m_resizable&&(b.m_width=d,b.m_height=e,b.m_camera.setViewAspect(d/e),b.m_camera.setParallelExtents({width:d,height:e}),b.modified()),b.m_renderPasses)for(f=0;f<b.m_renderPasses.length;f+=1)b.m_renderPasses[f].resize(d,e),b.m_renderPasses[f].renderer().positionAndResize(a,c,d,e)},this.addActor=function(a){return a instanceof vgl.actor?(b.m_sceneRoot.addChild(a),b.modified(),!0):!1},this.hasActor=function(a){return b.m_sceneRoot.hasChild(a)},this.addActors=function(a){var c=null;if(a instanceof Array){for(c=0;c<a.length;c+=1)b.m_sceneRoot.addChild(a[c]);b.modified()}},this.removeActor=function(a){return-1!==b.m_sceneRoot.children().indexOf(a)?(a.mapper()&&(a.mapper().deleteVertexBufferObjects(),a.mapper().modified()),b.m_sceneRoot.removeChild(a),b.modified(),!0):!1},this.removeActors=function(a){if(!(a instanceof Array))return!1;var c;for(c=0;c<a.length;c+=1)b.m_sceneRoot.removeChild(a[c]);return b.modified(),!0},this.removeAllActors=function(){return b.m_sceneRoot.removeChildren()},this.worldToDisplay=function(a,b,c,d,e){var f=mat4.create(),g=null,h=null,i=null,j=null,k=null;return mat4.multiply(f,c,b),k=vec4.create(),vec4.transformMat4(k,a,f),0!==k[3]&&(k[0]=k[0]/k[3],k[1]=k[1]/k[3],k[2]=k[2]/k[3],k[3]=1),g=(k[0]+1)/2*d,h=(1-k[1])/2*e,i=k[2],j=k[3],vec4.fromValues(g,h,i,j)},this.displayToWorld=function(a,b,c,d,e){var f=2*a[0]/d-1,g=-(2*a[1]/e)+1,h=a[2],i=mat4.create(),j=null;return mat4.multiply(i,c,b),mat4.invert(i,i),j=vec4.fromValues(f,g,h,1),vec4.transformMat4(j,j,i),0!==j[3]&&(j[0]=j[0]/j[3],j[1]=j[1]/j[3],j[2]=j[2]/j[3],j[3]=1),j},this.focusDisplayPoint=function(){var a=b.m_camera.focalPoint(),c=vec4.fromValues(a[0],a[1],a[2],1);return b.worldToDisplay(c,b.m_camera.viewMatrix(),b.m_camera.projectionMatrix(),b.m_width,b.m_height)},this.resetScene=function(){return b.m_resetScene},this.setResetScene=function(a){b.m_resetScene!==a&&(b.m_resetScene=a,b.modified())},this.resetClippingRange=function(){return b.m_resetClippingRange},this.setResetClippingRange=function(a){b.m_resetClippingRange!==a&&(b.m_resetClippingRange=a,b.modified())},this.addRenderPass=function(a){var c;if(b.m_renderPasses)for(c=0;c<b.m_renderPasses.length;c+=1)if(a===b.m_renderPasses[c])return;b.m_renderPasses=[],b.m_renderPasses.push(a)},this.removeRenderPass=function(a){a=a},this._cleanup=function(a){for(var c=b.m_sceneRoot.children(),d=0;d<c.length;d+=1){var e=c[d];e.material()._cleanup(a),e.mapper()._cleanup(a)}b.m_sceneRoot.removeChildren()},b},inherit(vgl.renderer,vgl.graphicsObject),vgl.renderWindow=function(a){"use strict";if(!(this instanceof vgl.renderWindow))return new vgl.renderWindow(a);vgl.graphicsObject.call(this);var b=this,c=0,d=0,e=400,f=400,g=a,h=null,i=[],j=null;return this.windowSize=function(){return[e,f]},this.setWindowSize=function(a,c){return e!==a||f!==c?(e=a,f=c,b.modified(),!0):!1},this.windowPosition=function(){return[c,d]},this.setWindowPosition=function(a,e){return c!==a||d!==e?(c=a,d=e,b.modified(),!0):!1},this.renderers=function(){return i},this.activeRenderer=function(){return h},this.addRenderer=function(a){return b.hasRenderer(a)===!1?(i.push(a),a.setRenderWindow(b),null===h&&(h=a),0!==a.layer()&&a.camera().setClearMask(vgl.GL.DepthBufferBit),b.modified(),!0):!1},this.removeRenderer=function(a){var c=i.indexOf(a);return-1!==c?(h===a&&(h=null),i.splice(c,1),b.modified(),!0):!1},this.getRenderer=function(a){return a<i.length?i[a]:(console.log("[WARNING] Out of index array"),null)},this.hasRenderer=function(a){var b;for(b=0;b<i.length;b+=1)if(a===i[b])return!0;return!1},this.resize=function(a,e){b.positionAndResize(c,d,a,e),b.modified()},this.positionAndResize=function(a,g,h,j){c=a,d=g,e=h,f=j;var k;for(k=0;k<i.length;k+=1)i[k].positionAndResize(c,d,e,f);b.modified()},this._setup=function(a){a=a,j=null;try{j=g.getContext("webgl")||g.getContext("experimental-webgl");var b;for(b=0;b<i.length;b+=1)(i[b].width()>e||0===i[b].width()||i[b].height()>f||0===i[b].height())&&i[b].resize(c,d,e,f);return!0}catch(h){}return j||console("[ERROR] Unable to initialize WebGL. Your browser may not support it."),!1},this.context=function(){return j},this._cleanup=function(a){var b;for(b=0;b<i.length;b+=1)i[b]._cleanup(a);vgl.clearCachedShaders(a?a.m_context:null)},this.render=function(){var a;for(i.sort(function(a,b){return a.layer()-b.layer()}),a=0;a<i.length;a+=1)i[a].render()},this.focusDisplayPoint=function(){return h.focusDisplayPoint()},this.displayToWorld=function(a,b,c,d){d=void 0===d?d=h:d;var g=d.camera();return c||(c=d.focusDisplayPoint()),d.displayToWorld(vec4.fromValues(a,b,c[2],1),g.viewMatrix(),g.projectionMatrix(),e,f)},this.worldToDisplay=function(a,b,c,d){d=void 0===d?d=h:d;var g=d.camera();return d.worldToDisplay(vec4.fromValues(a,b,c,1),g.viewMatrix(),g.projectionMatrix(),e,f)},b},inherit(vgl.renderWindow,vgl.graphicsObject),vgl.camera=function(a){"use strict";if(!(this instanceof vgl.camera))return new vgl.camera(a);vgl.groupNode.call(this),a=a||{};var b=30*Math.PI/180,c=vec4.fromValues(0,0,1,1),d=vec4.fromValues(0,0,0,1),e=vec3.fromValues(0,0,0),f=vec4.fromValues(0,1,0,0),g=vec4.fromValues(1,0,0,0),h=.01,i=1e4,j=1,k=vec4.fromValues(0,0,-1,0),l=vec4.fromValues(0,0,1,0),m=mat4.create(),n=mat4.create(),o=vgl.timestamp(),p=vgl.timestamp(),q=-1,r=1,s=1,t=-1,u={zoom:1,tilesize:256},v=!0,w=!0,x=!0,y=!1,z=[0,0,0,0],A=1,B=vgl.GL.COLOR_BUFFER_BIT|vgl.GL.DEPTH_BUFFER_BIT;return void 0!==a.parallelProjection&&(y=a.parallelProjection?!0:!1),this.viewAngle=function(){return b},this.setViewAngleDegrees=function(a){b=Math.PI*a/180,this.modified()},this.setViewAngle=function(a){x&&(b=a,this.modified())},this.position=function(){return c},this.setPosition=function(a,b,d){v&&(c=vec4.fromValues(a,b,d,1),this.modified())},this.focalPoint=function(){return d},this.setFocalPoint=function(a,b,c){w&&v&&(d=vec4.fromValues(a,b,c,1),this.modified())},this.viewUpDirection=function(){return f},this.setViewUpDirection=function(a,b,c){f=vec4.fromValues(a,b,c,0),this.modified()},this.centerOfRotation=function(){return e},this.setCenterOfRotation=function(a){e=a,this.modified()},this.clippingRange=function(){return[h,i]},this.setClippingRange=function(a,b){h=a,i=b,this.modified()},this.viewAspect=function(){return j},this.setViewAspect=function(a){j=a,this.modified()},this.enableScale=function(){return x},this.setEnableScale=function(a){return a!==x?(x=a,this.modified(),!0):x},this.enableRotation=function(){return w},this.setEnableRotation=function(a){return a!==w?(w=a,this.modified(),!0):w},this.enableTranslation=function(){return v},this.setEnableTranslation=function(a){return a!==v?(v=a,this.modified(),!0):v},this.isEnabledParallelProjection=function(){return y},this.enableParallelProjection=function(a){return a!==y?(y=a,this.modified(),!0):y},this.setEnableParallelProjection=function(a){return this.enableParallelProjection(a)},this.parallelProjection=function(){return{left:q,right:r,top:s,bottom:t}},this.setParallelProjection=function(a,b,c,d){q=a,r=b,s=c,t=d,this.modified()},this.parallelExtents=function(){return u},this.setParallelExtents=function(a){var b,c,d=["width","height","zoom","tilesize"],e=!1;for(b=0;b<d.length;b+=1)c=d[b],void 0!==a[c]&&a[c]!==u[c]&&(u[c]=a[c],e=!0);if(e&&u.width&&u.height&&void 0!==u.zoom&&u.tilesize){var f=this.unitsPerPixel(u.zoom,u.tilesize);r=f*u.width/2,q=-r,s=f*u.height/2,t=-s,this.modified()}},this.unitsPerPixel=function(a,b){return b=b||256,360*Math.pow(2,-a)/b},this.directionOfProjection=function(){return this.computeDirectionOfProjection(),k},this.viewPlaneNormal=function(){return this.computeViewPlaneNormal(),l},this.viewMatrix=function(){return this.computeViewMatrix()},this.setViewMatrix=function(a,b){b?m=a.slice():mat4.copy(m,a),o.modified()},this.projectionMatrix=function(){return this.computeProjectionMatrix()},this.setProjectionMatrix=function(a){mat4.copy(n,a),p.modified()},this.clearMask=function(){return B},this.setClearMask=function(a){B=a,this.modified()},this.clearColor=function(){return z},this.setClearColor=function(a,b,c,d){z[0]=a,z[1]=b,z[2]=c,z[3]=d,this.modified()},this.clearDepth=function(){return A},this.setClearDepth=function(a){A=a,this.modified()},this.computeDirectionOfProjection=function(){vec3.subtract(k,d,c),vec3.normalize(k,k),this.modified()},this.computeViewPlaneNormal=function(){l[0]=-k[0],l[1]=-k[1],l[2]=-k[2]},this.zoom=function(a,b){0!==a&&v&&(a*=vec3.distance(d,c),b?(c[0]=c[0]+a*b[0],c[1]=c[1]+a*b[1],c[2]=c[2]+a*b[2]):(b=k,c[0]=d[0]-a*b[0],c[1]=d[1]-a*b[1],c[2]=d[2]-a*b[2]),this.modified())},this.pan=function(a,b,e){v&&(c[0]+=a,c[1]+=b,c[2]+=e,d[0]+=a,d[1]+=b,d[2]+=e,this.modified())},this.computeOrthogonalAxes=function(){this.computeDirectionOfProjection(),vec3.cross(g,k,f),vec3.normalize(g,g),this.modified()},this.rotate=function(a,b){if(w){a=.5*a*(Math.PI/180),b=.5*b*(Math.PI/180);var h=mat4.create(),i=new vec3.create;mat4.identity(h),i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],mat4.translate(h,h,e),mat4.rotate(h,h,a,f),mat4.rotate(h,h,b,g),mat4.translate(h,h,i),vec4.transformMat4(c,c,h),vec4.transformMat4(d,d,h),vec4.transformMat4(f,f,h),vec4.normalize(f,f),this.computeOrthogonalAxes(),this.modified()}},this.computeViewMatrix=function(){return o.getMTime()<this.getMTime()&&(mat4.lookAt(m,c,d,f),o.modified()),m},this.viewAlignment=function(){if(!y){var a=this.projectionMatrix();if(a[1]||a[2]||a[3]||a[4]||a[6]||a[7]||a[8]||a[9]||a[12]||a[13]||a[15])return null}var b=this.unitsPerPixel(u.zoom,u.tilesize);if(!u.width||!u.height||!b)return null;if(parseFloat(u.zoom.toFixed(6))!==parseFloat(u.zoom.toFixed(0)))return null;var c={roundx:b,roundy:b,dx:0,dy:0};return u.width%2&&(c.dx=.5*b),u.height%2&&(c.dy=.5*b),c},this.computeProjectionMatrix=function(){return p.getMTime()<this.getMTime()&&(y?mat4.ortho(n,q,r,t,s,h,i):mat4.perspective(n,b,j,h,i),p.modified()),n},this.zoomToHeight=function(a,c,d){return vgl.zoomToHeight(a,c,d,b)},this.computeDirectionOfProjection(),this},inherit(vgl.camera,vgl.groupNode),vgl.zoomToHeight=function(a,b,c,d){"use strict";d=d||30*Math.PI/180;var e=360*Math.pow(2,-a);return e/=2*Math.tan(d/2)*256/c},vgl.heightToZoom=function(a,b,c,d){"use strict";d=d||30*Math.PI/180,a*=2*Math.tan(d/2)*256/c;var e=-Math.log2(a/360);return e},vgl.interactorStyle=function(){"use strict";if(!(this instanceof vgl.interactorStyle))return new vgl.interactorStyle;vgl.object.call(this);var a=this,b=null;return this.viewer=function(){return b},this.setViewer=function(c){c!==b&&(b=c,$(b).on(vgl.event.mousePress,a.handleMouseDown),$(b).on(vgl.event.mouseRelease,a.handleMouseUp),$(b).on(vgl.event.mouseMove,a.handleMouseMove),$(b).on(vgl.event.mouseOut,a.handleMouseOut),$(b).on(vgl.event.mouseWheel,a.handleMouseWheel),$(b).on(vgl.event.keyPress,a.handleKeyPress),$(b).on(vgl.event.mouseContextMenu,a.handleContextMenu),$(b).on(vgl.event.click,a.handleClick),$(b).on(vgl.event.dblClick,a.handleDoubleClick),this.modified())},this.handleMouseDown=function(a){return a=a,!0},this.handleMouseUp=function(a){return a=a,!0},this.handleMouseMove=function(a){return a=a,!0},this.handleMouseOut=function(a){return a=a,!0},this.handleMouseWheel=function(a){return a=a,!0},this.handleClick=function(a){return a=a,!0},this.handleDoubleClick=function(a){return a=a,!0},this.handleKeyPress=function(a){return a=a,!0},this.handleContextMenu=function(a){return a=a,!0},this.reset=function(){return!0},this},inherit(vgl.interactorStyle,vgl.object),vgl.trackballInteractorStyle=function(){"use strict";if(!(this instanceof vgl.trackballInteractorStyle))return new vgl.trackballInteractorStyle;vgl.interactorStyle.call(this);var a,b=this,c=!1,d=!1,e=!1,f={x:0,y:0},g={x:0,y:0};return this.handleMouseMove=function(h){var i,j,k,l,m,n,o,p,q,r,s,t=b.viewer().renderWindow().windowSize()[0],u=b.viewer().renderWindow().windowSize()[1],v=b.viewer().renderWindow().activeRenderer(),w=v.camera(),x=b.viewer().relMouseCoords(h);return a=!1,f={x:0,y:0},x.x<0||x.x>t?(f.x=0,a=!0):f.x=x.x,x.y<0||x.y>u?(f.y=0,a=!0):f.y=x.y,a!==!0?(i=w.focalPoint(),k=vec4.fromValues(i[0],i[1],i[2],1),j=v.worldToDisplay(k,w.viewMatrix(),w.projectionMatrix(),t,u),l=vec4.fromValues(f.x,f.y,j[2],1),m=vec4.fromValues(g.x,g.y,j[2],1),n=v.displayToWorld(l,w.viewMatrix(),w.projectionMatrix(),t,u),o=v.displayToWorld(m,w.viewMatrix(),w.projectionMatrix(),t,u),p=n[0]-o[0],q=n[1]-o[1],r=n[2]-o[2],e&&(w.pan(-p,-q,-r),b.viewer().render()),c&&(w.rotate(g.x-f.x,g.y-f.y),v.resetCameraClippingRange(),b.viewer().render()),d&&(s=2*(f.y-g.y)/u,s>0?w.zoom(1-Math.abs(s)):w.zoom(1+Math.abs(s)),v.resetCameraClippingRange(),b.viewer().render()),g.x=f.x,g.y=f.y,!1):void 0},this.handleMouseDown=function(a){var f;return 0===a.button&&(c=!0),1===a.button&&(e=!0),2===a.button&&(d=!0),f=b.viewer().relMouseCoords(a),f.x<0?g.x=0:g.x=f.x,f.y<0?g.y=0:g.y=f.y,!1},this.handleMouseUp=function(a){return 0===a.button&&(c=!1),1===a.button&&(e=!1),2===a.button&&(d=!1),!1},this.handleMouseWheel=function(a){var c=b.viewer().renderWindow().activeRenderer(),d=c.camera();return a.originalEvent.wheelDelta<0?d.zoom(.9):d.zoom(1.1),c.resetCameraClippingRange(),b.viewer().render(),!0},this},inherit(vgl.trackballInteractorStyle,vgl.interactorStyle),vgl.pvwInteractorStyle=function(){"use strict";function a(){d.resetCameraClippingRange(),t.viewer().render()}if(!(this instanceof vgl.pvwInteractorStyle))return new vgl.pvwInteractorStyle;vgl.trackballInteractorStyle.call(this);var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=this,u=!1,v=!1,w=!1,x={x:0,y:0};return this.handleMouseMove=function(y){var z=[],A=null,B=[],C=null;for(b=t.viewer().renderWindow().windowSize()[0],c=t.viewer().renderWindow().windowSize()[1],d=t.viewer().renderWindow().activeRenderer(),e=d.camera(),f=!1,g=t.viewer().relMouseCoords(y),h={x:0,y:0},z=t.viewer().renderWindow().renderers(),A=0;A<z.length;A+=1)d!==z[A]&&B.push(z[A].camera());if(g.x<0||g.x>b?(h.x=0,f=!0):h.x=g.x,g.y<0||g.y>c?(h.y=0,f=!0):h.y=g.y,f!==!0){if(i=e.focalPoint(),j=vec4.fromValues(i[0],i[1],i[2],1),k=d.worldToDisplay(j,e.viewMatrix(),e.projectionMatrix(),b,c),l=vec4.fromValues(h.x,h.y,k[2],1),m=vec4.fromValues(x.x,x.y,k[2],1),n=d.displayToWorld(l,e.viewMatrix(),e.projectionMatrix(),b,c),o=d.displayToWorld(m,e.viewMatrix(),e.projectionMatrix(),b,c),p=n[0]-o[0],q=n[1]-o[1],r=n[2]-o[2],w&&(e.pan(-p,-q,-r),a()),u){for(C=[x.x-h.x,x.y-h.y],e.rotate(C[0],C[1]),A=0;A<B.length;A+=1)B[A].rotate(C[0],C[1]);for(A=0;A<z.length;A+=1)z[A].resetCameraClippingRange();a()}return v&&(s=2*(h.y-x.y)/c,s>0?e.zoom(1-Math.abs(s)):e.zoom(1+Math.abs(s)),a()),x.x=h.x,x.y=h.y,!1}},this.handleMouseDown=function(a){return 0===a.button&&(u=!0),1===a.button&&(w=!0),2===a.button&&(v=!0),g=t.viewer().relMouseCoords(a),g.x<0?x.x=0:x.x=g.x,g.y<0?x.y=0:x.y=g.y,!1},this.handleMouseUp=function(a){return 0===a.button&&(u=!1),1===a.button&&(w=!1),2===a.button&&(v=!1),!1},this},inherit(vgl.pvwInteractorStyle,vgl.trackballInteractorStyle),vgl.viewer=function(a,b){"use strict";if(!(this instanceof vgl.viewer))return new vgl.viewer(a,b);vgl.object.call(this);var c=this,d=a,e=!0,f=null,g=vgl.renderer(b),h=vgl.renderWindow(d);return this.canvas=function(){return d},this.renderWindow=function(){return h},this.init=function(){null!==h?h._setup():console.log("[ERROR] No render window attached")},this.exit=function(a){null!==h?h._cleanup(a):console.log("[ERROR] No render window attached")},this.interactorStyle=function(){return f},this.setInteractorStyle=function(a){a!==f&&(f=a,f.setViewer(this),this.modified())},this.handleMouseDown=function(a){if(e===!0){var b=$.event.fix(a||window.event);2===a.button&&b.preventDefault(),b.state="down",b.type=vgl.event.mousePress,$(c).trigger(b)}return!0},this.handleMouseUp=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.state="up",b.type=vgl.event.mouseRelease,$(c).trigger(b)}return!0},this.handleMouseMove=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.type=vgl.event.mouseMove,$(c).trigger(b)}return!0},this.handleMouseWheel=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.type=vgl.event.mouseWheel,$(c).trigger(b)}return!0},this.handleMouseOut=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.type=vgl.event.mouseOut,$(c).trigger(b)}return!0},this.handleKeyPress=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.type=vgl.event.keyPress,$(c).trigger(b)}return!0},this.handleContextMenu=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.type=vgl.event.contextMenu,$(c).trigger(b)}return!1},this.handleClick=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.type=vgl.event.click,$(c).trigger(b)}return!1},this.handleDoubleClick=function(a){if(e===!0){var b=$.event.fix(a||window.event);b.preventDefault(),b.type=vgl.event.dblClick,$(c).trigger(b)}return!1},this.relMouseCoords=function(a){if(void 0===a.pageX||void 0===a.pageY)throw"Missing attributes pageX and pageY on the event";var b=0,c=0,e=0,f=0,g=d;do b+=g.offsetLeft-g.scrollLeft,c+=g.offsetTop-g.scrollTop,g=g.offsetParent;while(g);return e=a.pageX-b,f=a.pageY-c,{x:e,y:f}},this.render=function(){h.render()},this.bindEventHandlers=function(){$(d).on("mousedown",this.handleMouseDown),$(d).on("mouseup",this.handleMouseUp),$(d).on("mousemove",this.handleMouseMove),$(d).on("mousewheel",this.handleMouseWheel),$(d).on("contextmenu",this.handleContextMenu)},this.unbindEventHandlers=function(){$(d).off("mousedown",this.handleMouseDown),$(d).off("mouseup",this.handleMouseUp),$(d).off("mousemove",this.handleMouseMove),$(d).off("mousewheel",this.handleMouseWheel),$(d).off("contextmenu",this.handleContextMenu)},this._init=function(){this.bindEventHandlers(),h.addRenderer(g)},this._init(),this},inherit(vgl.viewer,vgl.object),vgl.shader=function(a){"use strict";if(!(this instanceof vgl.shader))return new vgl.shader(a);vgl.object.call(this);var b=null,c=vgl.timestamp(),d=a,e="";this.shaderHandle=function(){return b},this.shaderType=function(){return d},this.shaderSource=function(){return e},this.setShaderSource=function(a){e=a,this.modified()},this.compile=function(a){return this.getMTime()<c.getMTime()?b:(a.m_context.deleteShader(b),b=a.m_context.createShader(d),a.m_context.shaderSource(b,e),a.m_context.compileShader(b),a.m_context.getShaderParameter(b,vgl.GL.COMPILE_STATUS)?(c.modified(),b):(console.log("[ERROR] An error occurred compiling the shaders: "+a.m_context.getShaderInfoLog(b)),console.log(e),a.m_context.deleteShader(b),null))},this.attachShader=function(a,c){a.m_context.attachShader(c,b)}},inherit(vgl.shader,vgl.object),function(){"use strict";var a=[],b=10;vgl.getCachedShader=function(c,d,e){for(var f=0;f<a.length;f+=1)if(a[f].type===c&&a[f].context===d&&a[f].source===e)return f&&a.splice(0,0,a.splice(f,1)[0]),a[0].shader;var g=new vgl.shader(c);return g.setShaderSource(e),a.unshift({type:c,context:d,source:e,shader:g}),a.length>=b&&a.splice(b,a.length-b),g},vgl.clearCachedShaders=function(b){for(var c=a.length-1;c>=0;c-=1)(null===b||void 0===b||a[c].context===b)&&a.splice(c,1)}}();var getBaseUrl=function(){"use strict";var a=document.getElementsByTagName("script"),b=a.length-1,c=a[b];b=c.src.lastIndexOf("/");var d=c.src.substring(0,b);return function(){return d}}();vgl.shaderProgram=function(){"use strict";if(!(this instanceof vgl.shaderProgram))return new vgl.shaderProgram;vgl.materialAttribute.call(this,vgl.materialAttributeType.ShaderProgram);var a=this,b=0,c=vgl.timestamp(),d=vgl.timestamp(),e=[],f=[],g={},h={},i={};return this.loadFromFile=function(b,c){var d;$.ajax({url:c,type:"GET",async:!1,success:function(c){d=vgl.shader(b),d.setShaderSource(c),a.addShader(d)}})},this.loadShader=function(a,b){this.loadFromFile(a,getBaseUrl()+"/shaders/"+b)},this.queryUniformLocation=function(a,c){return a.m_context.getUniformLocation(b,c)},this.queryAttributeLocation=function(a,c){return a.m_context.getAttribLocation(b,c)},this.addShader=function(b){if(e.indexOf(b)>-1)return!1;var c;for(c=0;c<e.length;c+=1)e[c].shaderType()===b.shaderType()&&e.splice(e.indexOf(b),1);return e.push(b),a.modified(),!0},this.addUniform=function(b){return f.indexOf(b)>-1?!1:(f.push(b),void a.modified())},this.addVertexAttribute=function(b,c){g[c]=b,a.modified()},this.uniformLocation=function(a){return h[a]},this.attributeLocation=function(a){return i[a]},this.uniform=function(a){var b;for(b=0;b<f.length;b+=1)if(f[b].name()===a)return f[b];return null},this.updateUniforms=function(a){var b;for(b=0;b<f.length;b+=1)f[b].callGL(a,h[f[b].name()])},this.link=function(a){return a.m_context.linkProgram(b),a.m_context.getProgramParameter(b,vgl.GL.LINK_STATUS)?!0:(console.log("[ERROR] Unable to initialize the shader program."),!1)},this.use=function(a){a.m_context.useProgram(b)},this._setup=function(a){0===b&&(b=a.m_context.createProgram())},this._cleanup=function(b){a.deleteVertexAndFragment(b),a.deleteProgram(b)},this.deleteProgram=function(a){a.m_context.deleteProgram(b)},this.deleteVertexAndFragment=function(a){var b;for(b=0;b<e.length;b+=1)a.m_context.detachShader(e[b].shaderHandle()),a.m_context.deleteShader(e[b].shaderHandle())},this.compileAndLink=function(d){var f;if(!(c.getMTime()>=this.getMTime())){for(a._setup(d),f=0;f<e.length;f+=1)e[f].compile(d),e[f].attachShader(d,b);a.bindAttributes(d),a.link(d)||(console.log("[ERROR] Failed to link Program"),
a._cleanup(d)),c.modified()}},this.bind=function(b){var c=0;for(d.getMTime()<a.getMTime()?(a.compileAndLink(b),a.use(b),a.bindUniforms(b),d.modified()):a.use(b),c=0;c<f.length;c+=1)f[c].update(b,a);a.updateUniforms(b)},this.undoBind=function(a){a.m_context.useProgram(null)},this.bindVertexData=function(a,b){g.hasOwnProperty(b)&&g[b].bindVertexData(a,b)},this.undoBindVertexData=function(a,b){g.hasOwnProperty(b)&&g[b].undoBindVertexData(a,b)},this.bindUniforms=function(a){var b;for(b=0;b<f.length;b+=1)h[f[b].name()]=this.queryUniformLocation(a,f[b].name())},this.bindAttributes=function(a){var c,d;for(c in g)g.hasOwnProperty(c)&&(d=g[c].name(),a.m_context.bindAttribLocation(b,c,d),i[d]=c)},a},inherit(vgl.shaderProgram,vgl.materialAttribute),vgl.texture=function(){"use strict";function a(a){switch(c.m_textureUnit){case 0:a.m_context.activeTexture(vgl.GL.TEXTURE0);break;case 1:a.m_context.activeTexture(vgl.GL.TEXTURE1);break;case 2:a.m_context.activeTexture(vgl.GL.TEXTURE2);break;case 3:a.m_context.activeTexture(vgl.GL.TEXTURE3);break;case 4:a.m_context.activeTexture(vgl.GL.TEXTURE4);break;case 5:a.m_context.activeTexture(vgl.GL.TEXTURE5);break;case 6:a.m_context.activeTexture(vgl.GL.TEXTURE6);break;case 7:a.m_context.activeTexture(vgl.GL.TEXTURE7);break;case 8:a.m_context.activeTexture(vgl.GL.TEXTURE8);break;case 9:a.m_context.activeTexture(vgl.GL.TEXTURE9);break;case 10:a.m_context.activeTexture(vgl.GL.TEXTURE10);break;case 11:a.m_context.activeTexture(vgl.GL.TEXTURE11);break;case 12:a.m_context.activeTexture(vgl.GL.TEXTURE12);break;case 13:a.m_context.activeTexture(vgl.GL.TEXTURE13);break;case 14:a.m_context.activeTexture(vgl.GL.TEXTURE14);break;case 15:a.m_context.activeTexture(vgl.GL.TEXTURE15);break;default:throw"[error] Texture unit "+c.m_textureUnit+" is not supported"}}if(!(this instanceof vgl.texture))return new vgl.texture;vgl.materialAttribute.call(this,vgl.materialAttributeType.Texture),this.m_width=0,this.m_height=0,this.m_depth=0,this.m_textureHandle=null,this.m_textureUnit=0,this.m_pixelFormat=vgl.GL.RGBA,this.m_pixelDataType=vgl.GL.UNSIGNED_BYTE,this.m_internalFormat=vgl.GL.RGBA,this.m_nearestPixel=!1,this.m_image=null;var b=vgl.timestamp(),c=this;return this.setup=function(c){a(c),c.m_context.deleteTexture(this.m_textureHandle),this.m_textureHandle=c.m_context.createTexture(),c.m_context.bindTexture(vgl.GL.TEXTURE_2D,this.m_textureHandle),c.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_MIN_FILTER,this.m_nearestPixel?vgl.GL.NEAREST:vgl.GL.LINEAR),c.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_MAG_FILTER,this.m_nearestPixel?vgl.GL.NEAREST:vgl.GL.LINEAR),c.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_WRAP_S,vgl.GL.CLAMP_TO_EDGE),c.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_WRAP_T,vgl.GL.CLAMP_TO_EDGE),null!==this.m_image?(c.m_context.pixelStorei(vgl.GL.UNPACK_ALIGNMENT,1),c.m_context.pixelStorei(vgl.GL.UNPACK_FLIP_Y_WEBGL,!0),this.updateDimensions(),this.computeInternalFormatUsingImage(),c.m_context.texImage2D(vgl.GL.TEXTURE_2D,0,this.m_internalFormat,this.m_pixelFormat,this.m_pixelDataType,this.m_image)):c.m_context.texImage2D(vgl.GL.TEXTURE_2D,0,this.m_internalFormat,this.m_width,this.m_height,0,this.m_pixelFormat,this.m_pixelDataType,null),c.m_context.bindTexture(vgl.GL.TEXTURE_2D,null),b.modified()},this.bind=function(c){this.getMTime()>b.getMTime()&&this.setup(c),a(c),c.m_context.bindTexture(vgl.GL.TEXTURE_2D,this.m_textureHandle)},this.undoBind=function(a){a.m_context.bindTexture(vgl.GL.TEXTURE_2D,null)},this.image=function(){return this.m_image},this.setImage=function(a){return null!==a?(this.m_image=a,this.updateDimensions(),this.modified(),!0):!1},this.nearestPixel=function(){return this.m_nearestPixel},this.setNearestPixel=function(a){return a=a?!0:!1,a!==this.m_nearestPixel?(this.m_nearestPixel=a,this.modified(),!0):!1},this.textureUnit=function(){return this.m_textureUnit},this.setTextureUnit=function(a){return this.m_textureUnit===a?!1:(this.m_textureUnit=a,this.modified(),!0)},this.width=function(){return this.m_width},this.setWidth=function(a){return c.m_width!==a?(c.m_width=a,c.modified(),!0):!1},this.height=function(){return c.m_height},this.setHeight=function(a){return c.m_height!==a?(c.m_height=a,c.modified(),!0):!1},this.depth=function(){return this.m_depth},this.setDepth=function(a){return null===this.m_image?!1:(this.m_depth=a,this.modified(),!0)},this.textureHandle=function(){return this.m_textureHandle},this.internalFormat=function(){return this.m_internalFormat},this.setInternalFormat=function(a){return this.m_internalFormat!==a?(this.m_internalFormat=a,this.modified(),!0):!1},this.pixelFormat=function(){return this.m_pixelFormat},this.setPixelFormat=function(a){return null===this.m_image?!1:(this.m_pixelFormat=a,this.modified(),!0)},this.pixelDataType=function(){return this.m_pixelDataType},this.setPixelDataType=function(a){return null===this.m_image?!1:(this.m_pixelDataType=a,this.modified(),!0)},this.computeInternalFormatUsingImage=function(){this.m_internalFormat=vgl.GL.RGBA,this.m_pixelFormat=vgl.GL.RGBA,this.m_pixelDataType=vgl.GL.UNSIGNED_BYTE},this.updateDimensions=function(){null!==this.m_image&&(this.m_width=this.m_image.width,this.m_height=this.m_image.height,this.m_depth=0)},this},inherit(vgl.texture,vgl.materialAttribute),vgl.lookupTable=function(){"use strict";if(!(this instanceof vgl.lookupTable))return new vgl.lookupTable;vgl.texture.call(this);var a=vgl.timestamp(),b=[0,0];return this.m_colorTable=[.07514311,.468049805,1,1,.247872569,.498782363,1,1,.339526309,.528909511,1,1,.409505078,.558608486,1,1,.468487184,.588057293,1,1,.520796675,.617435078,1,1,.568724526,.646924167,1,1,.613686735,.676713218,1,1,.656658579,.707001303,1,1,.698372844,.738002964,1,1,.739424025,.769954435,1,1,.780330104,.803121429,1,1,.821573924,.837809045,1,1,.863634967,.874374691,1,1,.907017747,.913245283,1,1,.936129275,.938743558,.983038586,1,.943467973,.943498599,.943398095,1,.990146732,.928791426,.917447482,1,1,.88332677,.861943246,1,1,.833985467,.803839606,1,1,.788626485,.750707739,1,1,.746206642,.701389973,1,1,.70590052,.654994046,1,1,.667019783,.610806959,1,1,.6289553,.568237474,1,1,.591130233,.526775617,1,1,.552955184,.485962266,1,1,.513776083,.445364274,1,1,.472800903,.404551679,1,1,.428977855,.363073592,1,1,.380759558,.320428137,1,.961891484,.313155629,.265499262,1,.916482116,.236630659,.209939162,1].map(function(a){return 255*a}),this.setup=function(b){0===this.textureUnit()?b.m_context.activeTexture(vgl.GL.TEXTURE0):1===this.textureUnit()&&b.m_context.activeTexture(vgl.GL.TEXTURE1),b.m_context.deleteTexture(this.m_textureHandle),this.m_textureHandle=b.m_context.createTexture(),b.m_context.bindTexture(vgl.GL.TEXTURE_2D,this.m_textureHandle),b.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_MIN_FILTER,vgl.GL.LINEAR),b.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_MAG_FILTER,vgl.GL.LINEAR),b.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_WRAP_S,vgl.GL.CLAMP_TO_EDGE),b.m_context.texParameteri(vgl.GL.TEXTURE_2D,vgl.GL.TEXTURE_WRAP_T,vgl.GL.CLAMP_TO_EDGE),b.m_context.pixelStorei(vgl.GL.UNPACK_ALIGNMENT,1),this.m_width=this.m_colorTable.length/4,this.m_height=1,this.m_depth=0,b.m_context.texImage2D(vgl.GL.TEXTURE_2D,0,vgl.GL.RGBA,this.m_width,this.m_height,this.m_depth,vgl.GL.RGBA,vgl.GL.UNSIGNED_BYTE,new Uint8Array(this.m_colorTable)),b.m_context.bindTexture(vgl.GL.TEXTURE_2D,null),a.modified()},this.colorTable=function(){return this.m_colorTable},this.setColorTable=function(a){return this.m_colorTable===a?!1:(this.m_colorTable=a,this.modified(),!0)},this.range=function(){return b},this.setRange=function(a){return b===a?!1:(b=a,this.modified(),!0)},this.updateRange=function(a){a instanceof Array||console.log("[error] Invalid data type for range. Requires array [min,max]"),a[0]<b[0]&&(b[0]=a[0],this.modified()),a[1]>b[1]&&(b[1]=a[1],this.modified())},this},inherit(vgl.lookupTable,vgl.texture),vgl.uniform=function(a,b){"use strict";if(!(this instanceof vgl.uniform))return new vgl.uniform;this.getTypeNumberOfComponents=function(a){switch(a){case vgl.GL.FLOAT:case vgl.GL.INT:case vgl.GL.BOOL:return 1;case vgl.GL.FLOAT_VEC2:case vgl.GL.INT_VEC2:case vgl.GL.BOOL_VEC2:return 2;case vgl.GL.FLOAT_VEC3:case vgl.GL.INT_VEC3:case vgl.GL.BOOL_VEC3:return 3;case vgl.GL.FLOAT_VEC4:case vgl.GL.INT_VEC4:case vgl.GL.BOOL_VEC4:return 4;case vgl.GL.FLOAT_MAT3:return 9;case vgl.GL.FLOAT_MAT4:return 16;default:return 0}};var c=a,d=b,e=[];return e.length=this.getTypeNumberOfComponents(c),this.name=function(){return d},this.type=function(){return c},this.get=function(){return e},this.set=function(a){var b=0;if(16===e.length)for(b=0;16>b;b+=1)e[b]=a[b];else if(9===e.length)for(b=0;9>b;b+=1)e[b]=a[b];else if(4===e.length)for(b=0;4>b;b+=1)e[b]=a[b];else if(3===e.length)for(b=0;3>b;b+=1)e[b]=a[b];else if(2===e.length)for(b=0;2>b;b+=1)e[b]=a[b];else e[0]=a},this.callGL=function(a,b){if(!(this.m_numberElements<1))switch(c){case vgl.GL.BOOL:case vgl.GL.INT:a.m_context.uniform1iv(b,e);break;case vgl.GL.FLOAT:a.m_context.uniform1fv(b,e);break;case vgl.GL.FLOAT_VEC2:a.m_context.uniform2fv(b,e);break;case vgl.GL.FLOAT_VEC3:a.m_context.uniform3fv(b,e);break;case vgl.GL.FLOAT_VEC4:a.m_context.uniform4fv(b,e);break;case vgl.GL.FLOAT_MAT3:a.m_context.uniformMatrix3fv(b,vgl.GL.FALSE,e);break;case vgl.GL.FLOAT_MAT4:a.m_context.uniformMatrix4fv(b,vgl.GL.FALSE,e)}},this.update=function(a,b){a=a,b=b},this},vgl.modelViewUniform=function(a){"use strict";return this instanceof vgl.modelViewUniform?(0===a.length&&(a="modelViewMatrix"),vgl.uniform.call(this,vgl.GL.FLOAT_MAT4,a),this.set(mat4.create()),this.update=function(a,b){b=b,this.set(a.m_modelViewMatrix)},this):new vgl.modelViewUniform(a)},inherit(vgl.modelViewUniform,vgl.uniform),vgl.modelViewOriginUniform=function(a,b){"use strict";if(!(this instanceof vgl.modelViewOriginUniform))return new vgl.modelViewOriginUniform(a,b);0===a.length&&(a="modelViewMatrix");var c=[b[0],b[1],b[2]||0];return vgl.uniform.call(this,vgl.GL.FLOAT_MAT4,a),this.set(mat4.create()),this.update=function(a,b){b=b;var d=mat4.create();if(mat4.translate(d,a.m_modelViewMatrix,c),a.m_modelViewAlignment){var e=a.m_modelViewAlignment;d[12]=Math.round(d[12]/e.roundx)*e.roundx+e.dx,d[13]=Math.round(d[13]/e.roundy)*e.roundy+e.dy}this.set(d)},this},inherit(vgl.modelViewOriginUniform,vgl.uniform),vgl.projectionUniform=function(a){"use strict";return this instanceof vgl.projectionUniform?(0===a.length&&(a="projectionMatrix"),vgl.uniform.call(this,vgl.GL.FLOAT_MAT4,a),this.set(mat4.create()),this.update=function(a,b){b=b,this.set(a.m_projectionMatrix)},this):new vgl.projectionUniform(a)},inherit(vgl.projectionUniform,vgl.uniform),vgl.floatUniform=function(a,b){"use strict";return this instanceof vgl.floatUniform?(0===a.length&&(a="floatUniform"),b=void 0===b?1:b,vgl.uniform.call(this,vgl.GL.FLOAT,a),void this.set(b)):new vgl.floatUniform(a,b)},inherit(vgl.floatUniform,vgl.uniform),vgl.normalMatrixUniform=function(a){"use strict";return this instanceof vgl.normalMatrixUniform?(0===a.length&&(a="normalMatrix"),vgl.uniform.call(this,vgl.GL.FLOAT_MAT4,a),this.set(mat4.create()),this.update=function(a,b){b=b,this.set(a.m_normalMatrix)},this):new vgl.normalMatrixUniform(a)},inherit(vgl.normalMatrixUniform,vgl.uniform),vgl.vertexAttributeKeys={Position:0,Normal:1,TextureCoordinate:2,Color:3,Scalar:4,CountAttributeIndex:5},vgl.vertexAttributeKeysIndexed={Zero:0,One:1,Two:2,Three:3,Four:4,Five:5,Six:6,Seven:7,Eight:8,Nine:9},vgl.vertexAttribute=function(a){"use strict";if(!(this instanceof vgl.vertexAttribute))return new vgl.vertexAttribute(a);var b=a;this.name=function(){return b},this.bindVertexData=function(a,c){var d=a.m_mapper.geometryData(),e=d.sourceData(c),f=a.m_material.shaderProgram();a.m_context.vertexAttribPointer(f.attributeLocation(b),e.attributeNumberOfComponents(c),e.attributeDataType(c),e.normalized(c),e.attributeStride(c),e.attributeOffset(c)),a.m_context.enableVertexAttribArray(f.attributeLocation(b))},this.undoBindVertexData=function(a,c){c=c;var d=a.m_material.shaderProgram();a.m_context.disableVertexAttribArray(d.attributeLocation(b))}},vgl.source=function(){"use strict";return this instanceof vgl.source?(vgl.object.call(this),this.create=function(){},this):new vgl.source},inherit(vgl.source,vgl.object),vgl.planeSource=function(){"use strict";if(!(this instanceof vgl.planeSource))return new vgl.planeSource;vgl.source.call(this);var a=[0,0,0],b=[1,0,0],c=[0,1,0],d=[0,0,1],e=1,f=1,g=null;this.setOrigin=function(b,c,d){a[0]=b,a[1]=c,a[2]=d},this.setPoint1=function(a,c,d){b[0]=a,b[1]=c,b[2]=d},this.setPoint2=function(a,b,d){c[0]=a,c[1]=b,c[2]=d},this.create=function(){g=new vgl.geometryData;var h,i,j,k,l,m,n,o=[],p=[],q=[],r=[],s=[],t=0,u=0,v=0,w=0,x=[],y=[],z=[],A=[],B=[],C=null,D=null,E=null;for(o.length=3,p.length=2,q.length=3,r.length=3,s.length=3,h=0;3>h;h+=1)q[h]=b[h]-a[h],r[h]=c[h]-a[h];for(l=(e+1)*(f+1),m=e*f*2,x.length=3*l,y.length=3*l,A.length=2*l,B.length=l,j=0,h=0;f+1>h;h+=1)for(p[1]=h/f,i=0;e+1>i;i+=1){for(p[0]=i/e,k=0;3>k;k+=1)o[k]=a[k]+p[0]*q[k]+p[1]*r[k];x[t++]=o[0],x[t++]=o[1],x[t++]=o[2],z[v++]=1,z[v++]=1,z[v++]=1,y[u++]=d[0],y[u++]=d[1],y[u++]=d[2],A[w++]=p[0],A[w++]=p[1]}for(h=0;f>h;h+=1)for(i=0;e>i;i+=1)s[0]=i+h*(e+1),s[1]=s[0]+1,s[2]=s[0]+e+2,s[3]=s[0]+e+1;for(h=0;l>h;h+=1)B[h]=h;return C=new vgl.triangleStrip,C.setIndices(B),D=vgl.sourceDataP3fv(),D.pushBack(x),E=vgl.sourceDataC3fv(),E.pushBack(z),n=vgl.sourceDataT2fv(),n.pushBack(A),g.addSource(D),g.addSource(E),g.addSource(n),g.addPrimitive(C),g}},inherit(vgl.planeSource,vgl.source),vgl.pointSource=function(){"use strict";if(!(this instanceof vgl.pointSource))return new vgl.pointSource;vgl.source.call(this);var a=this,b=[],c=[],d=[],e=[],f=null;this.getPositions=function(){return b},this.setPositions=function(c){c instanceof Array?b=c:console.log("[ERROR] Invalid data type for positions. Array is required."),a.modified()},this.getColors=function(){return c},this.setColors=function(b){b instanceof Array?c=b:console.log("[ERROR] Invalid data type for colors. Array is required."),a.modified()},this.getSize=function(){return e},this.setSize=function(a){e=a,this.modified()},this.setTextureCoordinates=function(b){b instanceof Array?d=b:console.log("[ERROR] Invalid data type for texture coordinates. Array is required."),a.modified()},this.create=function(){if(f=new vgl.geometryData,b.length%3!==0)return void console.log("[ERROR] Invalid length of the points array");var a,g,h,i,j,k=b.length/3,l=0,m=[];for(m.length=k,l=0;k>l;l+=1)m[l]=l;if(j=vgl.sourceDataDf(),k!==e.length)for(l=0;k>l;l+=1)j.pushBack(e);else j.setData(e);return f.addSource(j),a=new vgl.points,a.setIndices(m),g=vgl.sourceDataP3fv(),g.pushBack(b),f.addSource(g),c.length>0&&c.length===b.length?(h=vgl.sourceDataC3fv(),h.pushBack(c),f.addSource(h)):c.length>0&&c.length!==b.length&&console.log("[ERROR] Number of colors are different than number of points"),d.length>0&&d.length===b.length?(i=vgl.sourceDataT2fv(),i.pushBack(d),f.addSource(i)):d.length>0&&d.length/2!==b.length/3&&console.log("[ERROR] Number of texture coordinates are different than number of points"),f.addPrimitive(a),f}},inherit(vgl.pointSource,vgl.source),vgl.lineSource=function(a,b){"use strict";if(!(this instanceof vgl.lineSource))return new vgl.lineSource;vgl.source.call(this);var c=a,d=b;this.setPositions=function(a){return a instanceof Array?(c=a,this.modified(),!0):(console.log("[ERROR] Invalid data type for positions. Array is required."),!1)},this.setColors=function(a){return a instanceof Array?(d=a,this.modified(),!0):(console.log("[ERROR] Invalid data type for colors. Array is required."),!1)},this.create=function(){if(!c)return void console.log("[error] Invalid positions");if(c.length%3!==0)return void console.log("[error] Line source requires 3d points");if(c.length%3!==0)return void console.log("[ERROR] Invalid length of the points array");var a,b,e,f,g=new vgl.geometryData,h=c.length/3,i=[];for(i.length=h,a=0;h>a;a+=1)i[a]=a;return b=new vgl.lines,b.setIndices(i),e=vgl.sourceDataP3fv(),e.pushBack(c),g.addSource(e),d&&d.length>0&&d.length===c.length?(f=vgl.sourceDataC3fv(),f.pushBack(d),g.addSource(f)):d&&d.length>0&&d.length!==c.length&&console.log("[error] Number of colors are different than number of points"),g.addPrimitive(b),g}},inherit(vgl.lineSource,vgl.source),vgl.utils=function(){"use strict";return this instanceof vgl.utils?(vgl.object.call(this),this):new vgl.utils},inherit(vgl.utils,vgl.object),vgl.utils.computePowerOfTwo=function(a,b){"use strict";for(b=b||1;a>b;)b*=2;return b},vgl.utils.createTextureVertexShader=function(a){"use strict";var b=["attribute vec3 vertexPosition;","attribute vec3 textureCoord;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iTextureCoord = textureCoord;","}"].join("\n");return vgl.getCachedShader(vgl.GL.VERTEX_SHADER,a,b)},vgl.utils.createTextureFragmentShader=function(a){"use strict";var b=["varying highp vec3 iTextureCoord;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyz, opacity);","}"].join("\n");return vgl.getCachedShader(vgl.GL.FRAGMENT_SHADER,a,b)},vgl.utils.createRgbaTextureFragmentShader=function(a){"use strict";var b=["varying highp vec3 iTextureCoord;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","  mediump vec4 color = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyzw);","  color.w *= opacity;","  gl_FragColor = color;","}"].join("\n");return vgl.getCachedShader(vgl.GL.FRAGMENT_SHADER,a,b)},vgl.utils.createVertexShader=function(a){"use strict";var b=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying mediump vec3 iVertexColor;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iVertexColor = vertexColor;","}"].join("\n");return vgl.getCachedShader(vgl.GL.VERTEX_SHADER,a,b)},vgl.utils.createPointVertexShader=function(a){"use strict";var b=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","attribute float vertexSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying mediump vec3 iVertexColor;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize =  vertexSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iVertexColor = vertexColor;","}"].join("\n");return vgl.getCachedShader(vgl.GL.VERTEX_SHADER,a,b)},vgl.utils.createVertexShaderSolidColor=function(a){"use strict";var b=["attribute vec3 vertexPosition;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","}"].join("\n");return vgl.getCachedShader(vgl.GL.VERTEX_SHADER,a,b)},vgl.utils.createVertexShaderColorMap=function(a,b,c){"use strict";b=b,c=c;var d=["attribute vec3 vertexPosition;","attribute float vertexScalar;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float lutMin;","uniform float lutMax;","varying mediump float iVertexScalar;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","iVertexScalar = (vertexScalar-lutMin)/(lutMax-lutMin);","}"].join("\n");return vgl.getCachedShader(vgl.GL.VERTEX_SHADER,a,d)},vgl.utils.createFragmentShader=function(a){"use strict";var b=["varying mediump vec3 iVertexColor;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(iVertexColor, opacity);","}"].join("\n");return vgl.getCachedShader(vgl.GL.FRAGMENT_SHADER,a,b)},vgl.utils.createPhongVertexShader=function(a){"use strict";var b=["attribute highp vec3 vertexPosition;","attribute mediump vec3 vertexNormal;","attribute mediump vec3 vertexColor;","uniform highp mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 normalMatrix;","varying highp vec4 varPosition;","varying mediump vec3 varNormal;","varying mediump vec3 varVertexColor;","void main(void)","{","varPosition = modelViewMatrix * vec4(vertexPosition, 1.0);","gl_Position = projectionMatrix * varPosition;","varNormal = vec3(normalMatrix * vec4(vertexNormal, 0.0));","varVertexColor = vertexColor;","}"].join("\n");return vgl.getCachedShader(vgl.GL.VERTEX_SHADER,a,b)},vgl.utils.createPhongFragmentShader=function(a){"use strict";var b=["uniform mediump float opacity;","precision mediump float;","varying vec3 varNormal;","varying vec4 varPosition;","varying mediump vec3 varVertexColor;","const vec3 lightPos = vec3(0.0, 0.0,10000.0);","const vec3 ambientColor = vec3(0.01, 0.01, 0.01);","const vec3 specColor = vec3(0.0, 0.0, 0.0);","void main() {","vec3 normal = normalize(varNormal);","vec3 lightDir = normalize(lightPos);","vec3 reflectDir = -reflect(lightDir, normal);","vec3 viewDir = normalize(-varPosition.xyz);","float lambertian = max(dot(lightDir, normal), 0.0);","vec3 color = vec3(0.0);","if(lambertian > 0.0) {","  color = lambertian * varVertexColor;","}","gl_FragColor = vec4(color * opacity, 1.0 - opacity);","}"].join("\n");return vgl.getCachedShader(vgl.GL.FRAGMENT_SHADER,a,b)},vgl.utils.createFragmentShaderSolidColor=function(a,b){"use strict";var c=["uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4("+b[0]+","+b[1]+","+b[2]+", opacity);","}"].join("\n");return vgl.getCachedShader(vgl.GL.FRAGMENT_SHADER,a,c)},vgl.utils.createFragmentShaderColorMap=function(a){"use strict";var b=["varying mediump float iVertexScalar;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(texture2D(sampler2d, vec2(iVertexScalar, 0.0)).xyz, opacity);","}"].join("\n");return vgl.getCachedShader(vgl.GL.FRAGMENT_SHADER,a,b)},vgl.utils.createPointSpritesVertexShader=function(a){"use strict";var b=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","uniform mediump vec2 pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float height;","varying mediump vec3 iVertexColor;","varying highp float iVertexScalar;","void main(void)","{","mediump float realPointSize = pointSize.y;","if (pointSize.x > pointSize.y) {","  realPointSize = pointSize.x;}","gl_PointSize = realPointSize ;","iVertexScalar = vertexPosition.z;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition.xy, height, 1.0);"," iVertexColor = vertexColor;","}"].join("\n");return vgl.getCachedShader(vgl.GL.VERTEX_SHADER,a,b)},vgl.utils.createPointSpritesFragmentShader=function(a){"use strict";var b=["varying mediump vec3 iVertexColor;","varying highp float iVertexScalar;","uniform sampler2D opacityLookup;","uniform highp float lutMin;","uniform highp float lutMax;","uniform sampler2D scalarsToColors;","uniform int useScalarsToColors;","uniform int useVertexColors;","uniform mediump vec2 pointSize;","uniform mediump float vertexColorWeight;","void main(void) {","mediump vec2 realTexCoord;","if (pointSize.x > pointSize.y) {","  realTexCoord = vec2(1.0, pointSize.y/pointSize.x) * gl_PointCoord;","} else {","  realTexCoord = vec2(pointSize.x/pointSize.y, 1.0) * gl_PointCoord;","}","highp float texOpacity = texture2D(opacityLookup, realTexCoord).w;","if (useScalarsToColors == 1) {","  gl_FragColor = vec4(texture2D(scalarsToColors, vec2((iVertexScalar - lutMin)/(lutMax - lutMin), 0.0)).xyz, texOpacity);","} else if (useVertexColors == 1) {","  gl_FragColor = vec4(iVertexColor, texOpacity);","} else {","  gl_FragColor = vec4(texture2D(opacityLookup, realTexCoord).xyz, texOpacity);","}}"].join("\n");return vgl.getCachedShader(vgl.GL.FRAGMENT_SHADER,a,b)},vgl.utils.createTextureMaterial=function(a,b){"use strict";var c,d=new vgl.material,e=new vgl.blend,f=new vgl.shaderProgram,g=vgl.utils.createTextureVertexShader(vgl.GL),h=null,i=new vgl.vertexAttribute("vertexPosition"),j=new vgl.vertexAttribute("textureCoord"),k=new vgl.floatUniform("pointSize",5),l=new vgl.projectionUniform("projectionMatrix"),m=new vgl.uniform(vgl.GL.INT,"sampler2d"),n=null;return c=void 0!==b?new vgl.modelViewOriginUniform("modelViewMatrix",b):new vgl.modelViewUniform("modelViewMatrix"),m.set(0),f.addVertexAttribute(i,vgl.vertexAttributeKeys.Position),f.addVertexAttribute(j,vgl.vertexAttributeKeys.TextureCoordinate),f.addUniform(k),f.addUniform(c),f.addUniform(l),h=a?vgl.utils.createRgbaTextureFragmentShader(vgl.GL):vgl.utils.createTextureFragmentShader(vgl.GL),n=new vgl.floatUniform("opacity",1),f.addUniform(n),f.addShader(h),f.addShader(g),d.addAttribute(f),d.addAttribute(e),d},vgl.utils.createGeometryMaterial=function(){"use strict";var a=new vgl.material,b=new vgl.shaderProgram,c=5,d=1,e=vgl.utils.createVertexShader(vgl.GL),f=vgl.utils.createFragmentShader(vgl.GL),g=new vgl.vertexAttribute("vertexPosition"),h=new vgl.vertexAttribute("vertexColor"),i=new vgl.floatUniform("pointSize",c),j=new vgl.floatUniform("opacity",d),k=new vgl.modelViewUniform("modelViewMatrix"),l=new vgl.projectionUniform("projectionMatrix");return b.addVertexAttribute(g,vgl.vertexAttributeKeys.Position),b.addVertexAttribute(h,vgl.vertexAttributeKeys.Color),b.addUniform(i),b.addUniform(j),b.addUniform(k),b.addUniform(l),b.addShader(f),b.addShader(e),a.addAttribute(b),a},vgl.utils.createPointGeometryMaterial=function(a){"use strict";a=void 0===a?1:a;var b=new vgl.material,c=new vgl.blend,d=new vgl.shaderProgram,e=vgl.utils.createPointVertexShader(vgl.GL),f=vgl.utils.createFragmentShader(vgl.GL),g=new vgl.vertexAttribute("vertexPosition"),h=new vgl.vertexAttribute("vertexColor"),i=new vgl.vertexAttribute("vertexSize"),j=new vgl.floatUniform("opacity",a),k=new vgl.modelViewUniform("modelViewMatrix"),l=new vgl.projectionUniform("projectionMatrix");return d.addVertexAttribute(g,vgl.vertexAttributeKeys.Position),d.addVertexAttribute(h,vgl.vertexAttributeKeys.Color),d.addVertexAttribute(i,vgl.vertexAttributeKeys.Scalar),d.addUniform(j),d.addUniform(k),d.addUniform(l),d.addShader(f),d.addShader(e),b.addAttribute(d),b.addAttribute(c),b},vgl.utils.createPhongMaterial=function(){"use strict";var a=new vgl.material,b=new vgl.shaderProgram,c=vgl.utils.createPhongVertexShader(vgl.GL),d=vgl.utils.createPhongFragmentShader(vgl.GL),e=new vgl.vertexAttribute("vertexPosition"),f=new vgl.vertexAttribute("vertexNormal"),g=new vgl.vertexAttribute("vertexColor"),h=new vgl.floatUniform("opacity",1),i=new vgl.modelViewUniform("modelViewMatrix"),j=new vgl.normalMatrixUniform("normalMatrix"),k=new vgl.projectionUniform("projectionMatrix");return b.addVertexAttribute(e,vgl.vertexAttributeKeys.Position),b.addVertexAttribute(f,vgl.vertexAttributeKeys.Normal),b.addVertexAttribute(g,vgl.vertexAttributeKeys.Color),b.addUniform(h),b.addUniform(i),b.addUniform(k),b.addUniform(j),b.addShader(d),b.addShader(c),a.addAttribute(b),a},vgl.utils.createColorMaterial=function(){"use strict";var a=new vgl.material,b=new vgl.blend,c=new vgl.shaderProgram,d=vgl.utils.createVertexShader(vgl.GL),e=vgl.utils.createFragmentShader(vgl.GL),f=new vgl.vertexAttribute("vertexPosition"),g=new vgl.vertexAttribute("textureCoord"),h=new vgl.vertexAttribute("vertexColor"),i=new vgl.floatUniform("pointSize",5),j=new vgl.floatUniform("opacity",1),k=new vgl.modelViewUniform("modelViewMatrix"),l=new vgl.projectionUniform("projectionMatrix");return c.addVertexAttribute(f,vgl.vertexAttributeKeys.Position),c.addVertexAttribute(h,vgl.vertexAttributeKeys.Color),c.addVertexAttribute(g,vgl.vertexAttributeKeys.TextureCoordinate),c.addUniform(i),c.addUniform(j),c.addUniform(k),c.addUniform(l),c.addShader(e),c.addShader(d),a.addAttribute(c),a.addAttribute(b),a},vgl.utils.createColorMappedMaterial=function(a){"use strict";a||(a=new vgl.lookupTable);var b=a.range(),c=new vgl.material,d=new vgl.blend,e=new vgl.shaderProgram,f=vgl.utils.createVertexShaderColorMap(vgl.GL,b[0],b[1]),g=vgl.utils.createFragmentShaderColorMap(vgl.GL),h=new vgl.vertexAttribute("vertexPosition"),i=new vgl.vertexAttribute("vertexScalar"),j=new vgl.floatUniform("pointSize",5),k=new vgl.floatUniform("opacity",1),l=new vgl.floatUniform("lutMin",b[0]),m=new vgl.floatUniform("lutMax",b[1]),n=new vgl.modelViewUniform("modelViewMatrix"),o=new vgl.projectionUniform("projectionMatrix"),p=new vgl.uniform(vgl.GL.FLOAT,"sampler2d"),q=a;return p.set(0),e.addVertexAttribute(h,vgl.vertexAttributeKeys.Position),e.addVertexAttribute(i,vgl.vertexAttributeKeys.Scalar),e.addUniform(j),e.addUniform(k),e.addUniform(l),e.addUniform(m),e.addUniform(n),e.addUniform(o),e.addShader(g),e.addShader(f),c.addAttribute(e),c.addAttribute(d),c.addAttribute(q),c},vgl.utils.updateColorMappedMaterial=function(a,b){"use strict";if(!a)return void console.log("[warning] Invalid material. Nothing to update.");if(!b)return void console.log("[warning] Invalid lookup table. Nothing to update.");var c=a.shaderProgram().uniform("lutMin"),d=a.shaderProgram().uniform("lutMax");c.set(b.range()[0]),d.set(b.range()[1]),a.setAttribute(b)},vgl.utils.createSolidColorMaterial=function(a){"use strict";a||(a=[1,1,1]);var b=new vgl.material,c=new vgl.blend,d=new vgl.shaderProgram,e=vgl.utils.createVertexShaderSolidColor(vgl.GL),f=vgl.utils.createFragmentShaderSolidColor(vgl.GL,a),g=new vgl.vertexAttribute("vertexPosition"),h=new vgl.floatUniform("pointSize",5),i=new vgl.floatUniform("opacity",1),j=new vgl.modelViewUniform("modelViewMatrix"),k=new vgl.projectionUniform("projectionMatrix");return d.addVertexAttribute(g,vgl.vertexAttributeKeys.Position),d.addUniform(h),d.addUniform(i),d.addUniform(j),d.addUniform(k),d.addShader(f),d.addShader(e),b.addAttribute(d),b.addAttribute(c),b},vgl.utils.createPointSpritesMaterial=function(a,b){"use strict";var c=void 0===b?[0,1]:b.range(),d=new vgl.material,e=new vgl.blend,f=new vgl.shaderProgram,g=vgl.utils.createPointSpritesVertexShader(vgl.GL),h=vgl.utils.createPointSpritesFragmentShader(vgl.GL),i=new vgl.vertexAttribute("vertexPosition"),j=new vgl.vertexAttribute("vertexColor"),k=new vgl.floatUniform("height",0),l=new vgl.floatUniform("vertexColorWeight",0),m=new vgl.floatUniform("lutMin",c[0]),n=new vgl.floatUniform("lutMax",c[1]),o=new vgl.modelViewUniform("modelViewMatrix"),p=new vgl.projectionUniform("projectionMatrix"),q=new vgl.uniform(vgl.GL.INT,"opacityLookup"),r=new vgl.uniform(vgl.GL.INT,"scalarsToColors"),s=new vgl.uniform(vgl.GL.INT,"useScalarsToColors"),t=new vgl.uniform(vgl.GL.INT,"useVertexColors"),u=new vgl.uniform(vgl.GL.FLOAT_VEC2,"pointSize"),v=new vgl.texture;return q.set(0),r.set(1),s.set(0),t.set(0),u.set([1,1]),f.addVertexAttribute(i,vgl.vertexAttributeKeys.Position),f.addVertexAttribute(j,vgl.vertexAttributeKeys.Color),f.addUniform(k),f.addUniform(l),f.addUniform(o),f.addUniform(p),f.addUniform(q),f.addUniform(t),f.addUniform(s),f.addUniform(u),f.addShader(h),f.addShader(g),d.addAttribute(f),d.addAttribute(e),b&&(f.addUniform(r),s.set(1),f.addUniform(m),f.addUniform(n),b.setTextureUnit(1),d.addAttribute(b)),v.setImage(a),v.setTextureUnit(0),d.addAttribute(v),d},vgl.utils.createPlane=function(a,b,c,d,e,f,g,h,i){"use strict";var j=new vgl.mapper,k=new vgl.planeSource,l=vgl.utils.createGeometryMaterial(),m=new vgl.actor;return k.setOrigin(a,b,c),k.setPoint1(d,e,f),k.setPoint2(g,h,i),j.setGeometryData(k.create()),m.setMapper(j),m.setMaterial(l),m},vgl.utils.createTexturePlane=function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=new vgl.mapper,l=new vgl.planeSource,m=vgl.utils.createTextureMaterial(j,[a,b,c]),n=new vgl.actor;return l.setPoint1(d-a,e-b,f-c),l.setPoint2(g-a,h-b,i-c),
k.setGeometryData(l.create()),n.setMapper(k),n.setMaterial(m),n},vgl.utils.createPoints=function(a,b,c,d,e){"use strict";if(!a)return console.log("[ERROR] Cannot create points without positions"),null;e=void 0===e?1:e;var f=new vgl.mapper,g=new vgl.pointSource,h=vgl.utils.createPointGeometryMaterial(e),i=new vgl.actor;return g.setPositions(a),c&&g.setColors(c),d&&g.setTextureCoordinates(d),b?g.setSize(b):g.setSize(1),f.setGeometryData(g.create()),i.setMapper(f),i.setMaterial(h),i},vgl.utils.createPointSprites=function(a,b,c,d){"use strict";if(!a)return console.log("[ERROR] Point sprites requires an image"),null;if(!b)return console.log("[ERROR] Cannot create points without positions"),null;var e=new vgl.mapper,f=new vgl.pointSource,g=vgl.utils.createPointSpritesMaterial(a),h=new vgl.actor;return f.setPositions(b),c&&f.setColors(c),d&&f.setTextureCoordinates(d),e.setGeometryData(f.create()),h.setMapper(e),h.setMaterial(g),h},vgl.utils.createLines=function(a,b){"use strict";if(!a)return console.log("[ERROR] Cannot create points without positions"),null;var c=new vgl.mapper,d=new vgl.lineSource,e=vgl.utils.createGeometryMaterial(),f=new vgl.actor;return d.setPositions(a),b&&d.setColors(b),c.setGeometryData(d.create()),f.setMapper(c),f.setMaterial(e),f},vgl.utils.createColorLegend=function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){if(!b)return void console.log("[error] Create labels requires positions (x,y,z) array");if(b.length%3!==0)return void console.log("[error] Create labels require positions array contain 3d points");if(!c)return void console.log("[error] Create labels requires Valid range");var d,e=null,f=vgl.utils.computePowerOfTwo(48),g=0,h=[],i=[],j=[],k=[],l=b[6]-b[0],m=4;for(i.length=3,j.length=3,k.length=3,d=0;2>d;d+=1)g=d*(b.length-3),i[0]=b[g]-l,i[1]=b[g+1]-2*l,i[2]=b[g+2],j[0]=b[g]+l,j[1]=i[1],j[2]=i[2],k[0]=i[0],k[1]=b[1],k[2]=i[2],e=vgl.utils.createTexturePlane(i[0],i[1],i[2],j[0],j[1],j[2],k[0],k[1],k[2],!0),e.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute),e.material().setBinNumber(vgl.material.RenderBin.Overlay),e.material().addAttribute(vgl.utils.create2DTexture(c[d].toFixed(2).toString(),12,null)),h.push(e);return i[0]=.5*(b[0]+b[b.length-3]-f),i[1]=b[1]+m,i[2]=b[2],j[0]=i[0]+f,j[1]=i[1],j[2]=i[2],k[0]=i[0],k[1]=i[1]+f,k[2]=i[2],e=vgl.utils.createTexturePlane(i[0],i[1],i[2],j[0],j[1],j[2],k[0],k[1],k[2],!0),e.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute),e.material().setBinNumber(vgl.material.RenderBin.Overlay),e.material().addAttribute(vgl.utils.create2DTexture(a,24,null)),h.push(e),h}function i(a,b,c,d,e,f,g,i,j,k,l,m,n,o,p){p=p;var q=j-f,r=null,s=q/m,t=[],u=[];for(r=0;m>=r;r+=1)t.push(f+s*r),t.push(g),t.push(i),t.push(f+s*r),t.push(g+o),t.push(i);return u=u.concat(h(a,t,b.range()))}if(!b)return console.log("[error] Invalid lookup table"),[];var j=c[0]+d,k=c[1],l=0,m=c[0],n=c[1]+e,o=0,p=[],q=null,r=null,s=vgl.groupNode();return q=vgl.utils.createTexturePlane(c[0],c[1],c[2],j,k,l,m,n,o,!0),r=q.material(),r.addAttribute(b),q.setMaterial(r),s.addChild(q),q.material().setBinNumber(vgl.material.RenderBin.Overlay),q.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute),p.push(q),p=p.concat(i(a,b,c[0],c[1],c[1],m,k,l,j,k,l,f,g,5,3))},vgl.utils.create2DTexture=function(a,b,c,d,e,f,g){"use strict";var h=document.getElementById("textRendering"),i=null,j=vgl.texture();return d=d||"sans-serif",e=e||"center",f=f||"bottom","undefined"==typeof g&&(g=!0),h||(h=document.createElement("canvas")),i=h.getContext("2d"),h.setAttribute("id","textRendering"),h.style.display="none",h.height=vgl.utils.computePowerOfTwo(8*b),h.width=h.height,i.fillStyle="rgba(0, 0, 0, 0)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.fillStyle="rgba(200, 85, 10, 1.0)",i.textAlign=e,i.textBaseline=f,i.font=4*b+"px "+d,g&&(i.font="bold "+i.font),i.fillText(a,h.width/2,h.height/2,h.width),j.setImage(h),j.updateDimensions(),j},vgl.picker=function(){"use strict";if(!(this instanceof vgl.picker))return new vgl.picker;vgl.object.call(this);var a=[];return this.getActors=function(){return a},this.pick=function(b,c,d){if(void 0===b)return 0;if(void 0===c)return 0;if(void 0===d)return 0;a=[];var e,f,g,h,i,j,k,l,m,n,o,p=d.camera(),q=d.width(),r=d.height(),s=p.focalPoint(),t=vec4.fromValues(s[0],s[1],s[2],1),u=d.worldToDisplay(t,p.viewMatrix(),p.projectionMatrix(),q,r),v=vec4.fromValues(b,c,u[2],1),w=d.displayToWorld(v,p.viewMatrix(),p.projectionMatrix(),q,r),x=p.position(),y=[];for(g=0;3>g;g+=1)y[g]=w[g]-x[g];for(e=d.sceneRoot().children(),f=0,g=0;g<e.length;g+=1)if(o=e[g],o.visible()===!0){if(h=o.bounds(),y[0]>=0?(i=(h[0]-x[0])/y[0],j=(h[1]-x[0])/y[0]):(i=(h[1]-x[0])/y[0],j=(h[0]-x[0])/y[0]),y[1]>=0?(k=(h[2]-x[1])/y[1],l=(h[3]-x[1])/y[1]):(k=(h[3]-x[1])/y[1],l=(h[2]-x[1])/y[1]),i>l||k>j)continue;if(k>i&&(i=k),j>l&&(j=l),y[2]>=0?(m=(h[4]-x[2])/y[2],n=(h[5]-x[2])/y[2]):(m=(h[5]-x[2])/y[2],n=(h[4]-x[2])/y[2]),i>n||m>j)continue;m>i&&(i=m),j>n&&(j=n),a[f]=o,f+=1}return f},this},inherit(vgl.picker,vgl.object),vgl.shapefileReader=function(){"use strict";if(!(this instanceof vgl.shapefileReader))return new vgl.shapefileReader;var a=this,b=0,c=1,d=5,e=3;return this.int8=function(a,b){return a.charCodeAt(b)},this.bint32=function(a,b){return((255&a.charCodeAt(b))<<24)+((255&a.charCodeAt(b+1))<<16)+((255&a.charCodeAt(b+2))<<8)+(255&a.charCodeAt(b+3))},this.lint32=function(a,b){return((255&a.charCodeAt(b+3))<<24)+((255&a.charCodeAt(b+2))<<16)+((255&a.charCodeAt(b+1))<<8)+(255&a.charCodeAt(b))},this.bint16=function(a,b){return((255&a.charCodeAt(b))<<8)+(255&a.charCodeAt(b+1))},this.lint16=function(a,b){return((255&a.charCodeAt(b+1))<<8)+(255&a.charCodeAt(b))},this.ldbl64=function(a,b){var c=255&a.charCodeAt(b),d=255&a.charCodeAt(b+1),e=255&a.charCodeAt(b+2),f=255&a.charCodeAt(b+3),g=255&a.charCodeAt(b+4),h=255&a.charCodeAt(b+5),i=255&a.charCodeAt(b+6),j=255&a.charCodeAt(b+7),k=1-2*(j>>7),l=((127&j)<<4)+((240&i)>>4)-1023,m=(15&i)*Math.pow(2,48)+h*Math.pow(2,40)+g*Math.pow(2,32)+f*Math.pow(2,24)+e*Math.pow(2,16)+d*Math.pow(2,8)+c;return k*(1+m*Math.pow(2,-52))*Math.pow(2,l)},this.lfloat32=function(a,b){var c=255&a.charCodeAt(b),d=255&a.charCodeAt(b+1),e=255&a.charCodeAt(b+2),f=255&a.charCodeAt(b+3),g=1-2*(f>>7),h=((127&f)<<1)+((254&e)>>7)-127,i=(127&e)*Math.pow(2,16)+d*Math.pow(2,8)+c;return g*(1+i*Math.pow(2,-23))*Math.pow(2,h)},this.str=function(a,b,c){for(var d=[],e=b;b+c>e;){var f=a[e];if(0===f.charCodeAt(0))break;d.push(f),e+=1}return d.join("")},this.readHeader=function(a){var b=this.bint32(a,0),c=this.bint32(a,24),d=this.lint32(a,28),e=this.lint32(a,32);return{code:b,length:c,version:d,shapetype:e}},this.loadShx=function(b){for(var c=[],d=function(d){return c.push(2*a.bint32(b,d)),d+8},e=100;e<b.length;)e=d(e);return c},this.Shapefile=function(a){var b=a.path;$.ajax({url:b+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(c){var d=this.loadShx(c);$.ajax({url:b+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(c){$.ajax({url:b+".dbf",mimeType:"text/plain; charset=x-user-defined",success:function(b){var e=this.loadShp(c,b,d,a);a.success(e)}})}})}})},this.localShapefile=function(b){var c=b.shx,d=b.shp,e=b.dbf,f=new FileReader;f.onloadend=function(){var c=a.loadShx(f.result),g=new FileReader;g.onloadend=function(){var d=g.result,f=new FileReader;f.onloadend=function(){var e=f.result,g=a.loadShp(d,e,c,b);b.success(g)},f.readAsBinaryString(e)},g.readAsBinaryString(d)},f.readAsBinaryString(c)},this.loadDBF=function(b){var c=function(c){var d=a.str(b,c,10),e=a.str(b,c+11,1),f=a.int8(b,c+16);return{name:d,type:e,length:f}},d=a.int8(b,0);if(4===d)throw"Level 7 dBASE not supported";for(var e=a.lint32(b,4),f=a.lint16(b,8),g=a.lint16(b,10),h=32,i=32,j=h,k=[];f-1>j;)k.push(c(j)),j+=i;for(var l=[],m=f;f+e*g>m;){var n=a.str(b,m,1);if("*"===n)m+=g;else{m+=1;for(var o={},p=0;p<k.length;p+=1){var q,r=k[p];"C"===r.type?q=a.str(b,m,r.length).trim():"N"===r.type&&(q=parseFloat(a.str(b,m,r.length))),m+=r.length,o[r.name]=q}l.push(o)}}return l},this.loadShp=function(f,g,h,i){i=i;var j,k=[],l=function(b,c,d){for(var e=[],g=d-1;g>=c;g-=1){var h=a.ldbl64(f,b+16*g),i=a.ldbl64(f,b+16*g+8);e.push([h,i])}return e},m=function(g){var h,i,j,m,n,o,p,q,r,s=g+8,t=a.lint32(f,s);if(t===b)console.log("NULL Shape");else if(t===c){var u=a.ldbl64(f,s+4),v=a.ldbl64(f,s+12);k.push({type:"Point",attr:{},geom:[[u,v]]})}else if(t===d){for(h=a.lint32(f,s+36),i=a.lint32(f,s+40),j=g+52,m=g+52+4*h,r=[],n=0;h>n;n+=1)o=a.lint32(f,j+4*n),p=h>n+1?a.lint32(f,j+4*(n+1)):i,q=l(m,o,p),r.push(q);k.push({type:"Polygon",attr:{},geom:[r]})}else{if(t!==e)throw"Not Implemented: "+t;for(h=a.lint32(f,s+36),i=a.lint32(f,s+40),j=g+52,m=g+52+4*h,r=[],n=0;h>n;n+=1)o=a.lint32(f,j+4*n),p=h>n+1?a.lint32(f,j+4*(n+1)):i,q=l(m,o,p),r.push(q);k.push({type:"Polyline",attr:{},geom:[r]})}},n=this.loadDBF(g);for(j=0;j<h.length;j+=1){var o=h[j];m(o)}var p=[];for(j=0;j<k.length;j+=1){var q=k[j];q.attr=n[j],p.push(q)}return p},this},vgl.vtkReader=function(){"use strict";if(!(this instanceof vgl.vtkReader))return new vgl.vtkReader;var a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],b=[],c={},d=0,e=null,f=null,g=-1,h="",i=0,j=0,k=null,l=0;if(0===b.length)for(l=0;l<a.length;l+=1)b[a[l]]=l;return this.ntos=function(a){var b;return b=a.toString(16),1===b.length&&(b="0"+b),b="%"+b,unescape(b)},this.readReverseBase64=function(){var a;if(!h)return g;for(;;){if(i>=h.length)return g;if(a=h.charAt(i),i+=1,b[a])return b[a];if("A"===a)return 0}return g},this.decode64=function(a){var b="",c=new Array(4),d=!1;for(h=a,i=0;!d&&(c[0]=this.readReverseBase64())!==g&&(c[1]=this.readReverseBase64())!==g;)c[2]=this.readReverseBase64(),c[3]=this.readReverseBase64(),b+=this.ntos(c[0]<<2&255|c[1]>>4),c[2]!==g?(b+=this.ntos(c[1]<<4&255|c[2]>>2),c[3]!==g?b+=this.ntos(c[2]<<6&255|c[3]):d=!0):d=!0;return b},this.readNumber=function(a){var b=a[j++]+(a[j++]<<8)+(a[j++]<<16)+(a[j++]<<24);return b},this.readF3Array=function(a,b){var c,d=4*a*3,e=new Int8Array(d),f=null;for(c=0;d>c;c+=1)e[c]=b[j],j+=1;return f=new Float32Array(e.buffer)},this.readColorArray=function(a,b,c){var d,e=0,f=new Array(3*a);for(d=0;a>d;d+=1)f[e++]=b[j++]/255,f[e++]=b[j++]/255,f[e++]=b[j++]/255,j++;c.insert(f)},this.parseObject=function(a){var b,c,d,e,f,g,h,i,m,n,o,p=new vgl.geometryData,q=vgl.mapper(),r=[],s=null,t=null,u=null,v=null;for(t=atob(a.data),l=0;l<t.length;l+=1)r[l]=255&t.charCodeAt(l);if(j=0,b=this.readNumber(r),s=String.fromCharCode(r[j]),j+=1,p.setName(s),"L"===s)u=this.parseLineData(p,r),v=vgl.utils.createGeometryMaterial();else if("M"===s)u=this.parseMeshData(p,r),v=vgl.utils.createPhongMaterial();else if("P"===s)u=this.parsePointData(p,r),v=vgl.utils.createGeometryMaterial();else{if("C"===s){for(d=this.parseColorMapData(p,r,b),h=[],l=0;l<d.colors.length;l+=1)h.push(d.colors[l][1]),h.push(d.colors[l][2]),h.push(d.colors[l][3]),h.push(255*d.colors[l][0]);return g=new vgl.lookupTable,g.setColorTable(h),i=k.renderWindow().windowSize(),m=d.size[0]*i[0],n=d.size[1]*i[1],o=[d.position[0]*i[0],(1-d.position[1])*i[1],0],o[1]=o[1]-n,n=30,vgl.utils.createColorLegend(d.title,g,o,m,n,3,0)}console.log("Ignoring unrecognized encoded data type "+s)}return q.setGeometryData(p),a.hasTransparency&&(e=v.shaderProgram(),f=e.uniform("opacity"),console.log("opacity ",a.opacity),f.set(a.opacity),v.setBinNumber(1e3)),c=vgl.actor(),c.setMapper(q),c.setMaterial(v),c.setMatrix(mat4.transpose(mat4.create(),u)),[c]},this.parseLineData=function(a,b){var c,d,e,f,g,h,i,k,l=null,m=null,n=null,o=mat4.create(),p=null,q=0;for(d=this.readNumber(b),p=new Array(3*d),l=new vgl.sourceDataP3fv,e=this.readF3Array(d,b),k=0;d>k;k+=1)p[q++]=e[3*k],p[q++]=e[3*k+1],p[q++]=e[3*k+2];for(l.insert(p),a.addSource(l),m=new vgl.sourceDataC3fv,this.readColorArray(d,b,m),a.addSource(m),n=new vgl.lines,a.addPrimitive(n),c=this.readNumber(b),f=new Int8Array(2*c),k=0;2*c>k;k+=1)f[k]=b[j],j+=1;for(g=new Uint16Array(f.buffer),n.setIndices(g),n.setPrimitiveType(vgl.GL.LINES),h=64,f=new Int8Array(h),k=0;h>k;k+=1)f[k]=b[j],j+=1;return i=new Float32Array(f.buffer),mat4.copy(o,i),o},this.parseMeshData=function(a,b){var c,d,e,f,g,h,i,k,l,m=null,n=null,o=null,p=mat4.create(),q=null,r=null,s=0;for(d=this.readNumber(b),r=new Array(6*d),m=new vgl.sourceDataP3N3f,e=this.readF3Array(d,b),o=this.readF3Array(d,b),k=0;d>k;k+=1)r[s++]=e[3*k],r[s++]=e[3*k+1],r[s++]=e[3*k+2],r[s++]=o[3*k],r[s++]=o[3*k+1],r[s++]=o[3*k+2];for(m.insert(r),a.addSource(m),n=new vgl.sourceDataC3fv,this.readColorArray(d,b,n),a.addSource(n),f=[],q=new vgl.triangles,c=this.readNumber(b),f=new Int8Array(2*c),k=0;2*c>k;k+=1)f[k]=b[j],j+=1;for(g=new Uint16Array(f.buffer),q.setIndices(g),a.addPrimitive(q),h=64,f=new Int8Array(h),k=0;h>k;k+=1)f[k]=b[j],j+=1;return i=new Float32Array(f.buffer),mat4.copy(p,i),l=null,p},this.parsePointData=function(a,b){var c,d,e,f,g,h,i=mat4.create(),k=null,m=null,n=null,o=null,p=0;for(c=this.readNumber(b),o=new Array(3*c),k=new vgl.sourceDataP3fv,d=this.readF3Array(c,b),e=new Uint16Array(c),l=0;c>l;l+=1)e[l]=l,o[p++]=d[3*l],o[p++]=d[3*l+1],o[p++]=d[3*l+2];for(k.insert(o),a.addSource(k),m=new vgl.sourceDataC3fv,this.readColorArray(c,b,m),a.addSource(m),n=new vgl.points,n.setIndices(e),a.addPrimitive(n),g=64,f=new Int8Array(g),l=0;g>l;l+=1)f[l]=b[j],j+=1;return h=new Float32Array(f.buffer),mat4.copy(i,h),i},this.parseColorMapData=function(a,b,c){var d,e,f,g,h,i={};for(i.numOfColors=c,e=8,d=new Int8Array(e),g=0;e>g;g+=1)d[g]=b[j],j+=1;for(i.position=new Float32Array(d.buffer),e=8,d=new Int8Array(e),g=0;e>g;g+=1)d[g]=b[j],j+=1;for(i.size=new Float32Array(d.buffer),i.colors=[],h=0;h<i.numOfColors;h+=1){for(d=new Int8Array(4),g=0;4>g;g+=1)d[g]=b[j],j+=1;f=[new Float32Array(d.buffer)[0],b[j++],b[j++],b[j++]],i.colors[h]=f}for(i.orientation=b[j++],i.numOfLabels=b[j++],i.title="";j<b.length;)i.title+=String.fromCharCode(b[j++]);return i},this.parseSceneMetadata=function(a,b){var c,d,g,h=e.Renderers[b],i=a.camera();d=(h.size[0]-h.origin[0])*f.width,g=(h.size[1]-h.origin[1])*f.height,a.resize(d,g),i.setCenterOfRotation([h.LookAt[1],h.LookAt[2],h.LookAt[3]]),i.setViewAngleDegrees(h.LookAt[0]),i.setPosition(h.LookAt[7],h.LookAt[8],h.LookAt[9]),i.setFocalPoint(h.LookAt[1],h.LookAt[2],h.LookAt[3]),i.setViewUpDirection(h.LookAt[4],h.LookAt[5],h.LookAt[6]),0===b?(c=h.Background1,a.setBackgroundColor(c[0],c[1],c[2],1)):a.setResizable(!1),a.setLayer(b)},this.initScene=function(){var a,b;if(null===e)return k;for(b=e.Renderers.length-1;b>=0;b-=1)a=this.getRenderer(b),this.parseSceneMetadata(a,b);return k},this.createViewer=function(a){var b;return null===k&&(f=a,k=vgl.viewer(a),k.init(),k.renderWindow().removeRenderer(k.renderWindow().activeRenderer()),k.renderWindow().addRenderer(new vgl.depthPeelRenderer),c[0]=k.renderWindow().activeRenderer(),k.renderWindow().resize(a.width,a.height),b=vgl.pvwInteractorStyle(),k.setInteractorStyle(b)),k},this.deleteViewer=function(){c={},k=null},this.updateCanvas=function(a){return f=a,k.renderWindow().resize(a.width,a.height),k},this.numObjects=function(){return d},this.getRenderer=function(a){var b;return b=c[a],(null===b||"undefined"==typeof b)&&(b=new vgl.renderer,b.setResetScene(!1),b.setResetClippingRange(!1),k.renderWindow().addRenderer(b),0!==a&&b.camera().setClearMask(vgl.GL.DepthBufferBit),c[a]=b),b},this.setVtkScene=function(a){e=a},this},vgl.DataBuffers=function(a){"use strict";if(!(this instanceof vgl.DataBuffers))return new vgl.DataBuffers(a);var b,c={};b=a||0===a?a:256;var d=0,e=function(a,b,c,d){a||console.log("ack"),c||(c=0),d||(d=b.length);for(var e=0;d>e;e+=1)a[c+e]=b[e]},f=function(a){var d=b;for(a>2*d&&(d=a);a>d;)d*=2;b=d;for(var f in c)if(c.hasOwnProperty(f)){var g=new Float32Array(d*c[f].len),h=c[f].array;e(g,h),c[f].array=g,c[f].dirty=!0}};this.create=function(a,d){if(!d)throw"Length of buffer must be a positive integer";var e=new Float32Array(b*d);return c[a]={array:e,len:d,dirty:!1},c[a].array},this.alloc=function(a){d+a>=b&&f(d+a);var c=d;return d+=a,c},this.get=function(a){return c[a].array},this.write=function(a,b,d,f){e(c[a].array,b,d*c[a].len,f*c[a].len),c[a].dirty=!0},this.repeat=function(a,b,d,f){for(var g=0;f>g;g+=1)e(c[a].array,b,(d+g)*c[a].len,c[a].len);c[a].dirty=!0},this.count=function(){return d},this.data=function(a){return c[a].array}};
//# sourceMappingURL=vgl.min.js.map